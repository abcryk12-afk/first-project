<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NexChain - Admin Panel</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const API_BASE = 'https://first-project-8p98.onrender.com/api';

    // Global variables
    let adminToken = localStorage.getItem('adminToken');
    let allUsers = [];
    let allTransactions = [];
    let systemStats = {};
    let currentAdmin = JSON.parse(localStorage.getItem('adminUser')) || {};
    let autoLogoutTimer;
    let lastActivity = Date.now();

    // Check admin authentication
    function checkAdminAuth() {
      if (!adminToken) {
        console.log('‚ùå No admin token found, redirecting to login...');
        window.location.href = 'admin-login.html';
        return false;
      }
      
      // Check if it's an admin token (simple string format)
      if (adminToken.startsWith('admin-token-')) {
        console.log('‚úÖ Valid admin token found');
        return true;
      }
      
      // For JWT tokens (if we switch to JWT in future)
      try {
        const tokenData = JSON.parse(atob(adminToken.split('.')[1]));
        const now = Date.now() / 1000;
        
        if (tokenData.exp && tokenData.exp < now) {
          console.log('‚ùå Token expired, redirecting to login...');
          localStorage.removeItem('adminToken');
          localStorage.removeItem('adminUser');
          window.location.href = 'admin-login.html';
          return false;
        }
      } catch (error) {
        console.log('‚ùå Invalid token format, redirecting to login...');
        localStorage.removeItem('adminToken');
        localStorage.removeItem('adminUser');
        window.location.href = 'admin-login.html';
        return false;
      }
      
      return true;
    }

    // Auto-logout functionality
    function setupAutoLogout() {
      // Clear existing timer
      if (autoLogoutTimer) {
        clearTimeout(autoLogoutTimer);
      }
      
      // Set new timer for 30 minutes of inactivity
      autoLogoutTimer = setTimeout(() => {
        console.log('‚è∞ Session expired due to inactivity');
        showNotification('Session expired due to inactivity. Please login again.', 'warning');
        logout();
      }, 30 * 60 * 1000); // 30 minutes
    }

    // Track user activity
    function trackActivity() {
      lastActivity = Date.now();
      setupAutoLogout();
    }

    // Logout function
    function logout() {
      localStorage.removeItem('adminToken');
      localStorage.removeItem('adminUser');
      window.location.href = 'admin-login.html';
    }

    // Validate admin token with backend
    async function validateAdminToken() {
      try {
        // For admin tokens, we can skip backend validation for now
        if (adminToken.startsWith('admin-token-')) {
          console.log('‚úÖ Admin token format validated locally');
          return true;
        }
        
        const response = await fetch(`${API_BASE}/admin/validate`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${adminToken}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          console.log('‚úÖ Admin token validated by backend');
          return true;
        } else {
          console.log('‚ùå Admin token validation failed');
          return false;
        }
      } catch (error) {
        console.log('‚ö†Ô∏è Backend validation failed, accepting token');
        return true; // Fallback for live deployment
      }
    }

    // Load admin dashboard
    async function loadAdminDashboard() {
      if (!checkAdminAuth()) return;
      
      try {
        console.log('üîç Loading admin dashboard...');
        
        // Validate token with server
        const isValid = await validateAdminToken();
        if (!isValid) return;
        
        // Setup auto-logout
        setupAutoLogout();
        
        // Update admin info display
        updateAdminInfo();
        
        // Load all data with loading indicators
        showLoading(true, 'Loading dashboard data...');
        
        // Check if mobile device
        const isMobile = window.innerWidth <= 768;
        
        if (isMobile) {
          // Mobile: Load data sequentially to reduce network load
          console.log('üì± Mobile device detected - using staggered loading...');
          
          try {
            // Load critical data first
            await loadSystemStats();
            showLoading(true, 'Loading system stats...');
            
            await loadNewUsers();
            showLoading(true, 'Loading users...');
            
            await loadNewUserDeposits();
            showLoading(true, 'Loading deposits...');
            
            await loadWithdrawalRequests();
            showLoading(true, 'Loading withdrawals...');
            
            // Load less critical data last
            await loadAllUsers();
            showLoading(true, 'Loading all users...');
            
            await loadAllTransactions();
            showLoading(true, 'Loading transactions...');
            
          } catch (error) {
            console.error('‚ùå Mobile loading error:', error);
          }
        } else {
          // Desktop: Load all data at once
          await Promise.all([
            loadSystemStats(),
            loadAllUsers(),
            loadAllTransactions(),
            loadNewUsers(),
            loadNewUserDeposits(),
            loadWithdrawalRequests()
          ]);
        }
        
        updateDashboard();
        showLoading(false);
        console.log('‚úÖ Admin dashboard loaded successfully');
        
        // Setup real-time updates
        setupRealTimeUpdates();
        
        // Initialize analytics dashboard
        setTimeout(() => {
          initAnalytics();
          console.log('üìä Analytics dashboard initialized');
        }, 1000);
        
      } catch (error) {
        console.error('‚ùå Error loading dashboard:', error);
        showLoading(false);
        showNotification('Error loading dashboard: ' + error.message, 'error');
      }
    }

    // Loading indicator system
    function showLoading(show, message = 'Loading...') {
      const loadingOverlay = document.getElementById('loadingOverlay');
      const loadingMessage = document.getElementById('loadingMessage');
      
      // Check if mobile for different loading behavior
      const isMobile = window.innerWidth <= 768;
      
      if (show) {
        if (!loadingOverlay) {
          const overlay = document.createElement('div');
          overlay.id = 'loadingOverlay';
          overlay.innerHTML = `
            <div class="loading-container">
              <div class="loading-spinner"></div>
              <div class="loading-text">${message}</div>
              ${isMobile ? '<div class="loading-tips">Optimizing for mobile...</div>' : ''}
            </div>
          `;
          overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
          `;
          
          // Mobile-specific loading styles
          if (isMobile) {
            overlay.style.background = 'rgba(255, 255, 255, 0.95)';
          }
          
          document.body.appendChild(overlay);
          
          // Add loading styles
          const style = document.createElement('style');
          style.textContent = `
            .loading-container {
              text-align: center;
              padding: 2rem;
            }
            
            .loading-spinner {
              width: ${isMobile ? '40px' : '50px'};
              height: ${isMobile ? '40px' : '50px'};
              border: 4px solid #f3f3f3;
              border-top: 4px solid #4f46e5;
              border-radius: 50%;
              animation: spin 1s linear infinite;
              margin: 0 auto 1rem;
            }
            
            .loading-text {
              font-size: ${isMobile ? '1rem' : '1.1rem'};
              color: #333;
              font-weight: 500;
              margin-bottom: 0.5rem;
            }
            
            .loading-tips {
              font-size: ${isMobile ? '0.8rem' : '0.9rem'};
              color: #666;
              font-style: italic;
            }
            
            @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
            }
            
            @media (max-width: 768px) {
              .loading-container {
                padding: 1rem;
              }
              
              .loading-spinner {
                width: 30px;
                height: 30px;
                border-width: 3px;
              }
            }
          `;
          document.head.appendChild(style);
        } else {
          // Update existing loading message
          if (loadingMessage) {
            loadingMessage.textContent = message;
          }
        }
        
        // Prevent scrolling on mobile during loading
        if (isMobile) {
          document.body.style.overflow = 'hidden';
        }
        
      } else {
        // Remove loading overlay
        if (loadingOverlay) {
          loadingOverlay.style.opacity = '0';
          loadingOverlay.style.transition = 'opacity 0.3s ease';
          
          setTimeout(() => {
            if (loadingOverlay.parentNode) {
              loadingOverlay.parentNode.removeChild(loadingOverlay);
            }
            // Restore scrolling
            if (isMobile) {
              document.body.style.overflow = '';
            }
          }, 300);
        }
      }
    }

    // Table loading indicators
    function showTableLoading(tableId, show = true) {
      const tbody = document.getElementById(tableId);
      if (!tbody) return;
      
      if (show) {
        tbody.innerHTML = `
          <tr>
            <td colspan="100%" style="text-align: center; padding: 40px;">
              <div class="table-loading">
                <div class="loading-spinner"></div>
                <p>Loading data...</p>
              </div>
            </td>
          </tr>
        `;
      }
    }

    // Real-time updates system
    let realTimeInterval;
    function setupRealTimeUpdates() {
      // Clear existing interval
      if (realTimeInterval) {
        clearInterval(realTimeInterval);
      }
      
      // Check if mobile device
      const isMobile = window.innerWidth <= 768;
      
      // Mobile: Update less frequently to save battery and data
      const updateInterval = isMobile ? 60000 : 30000; // 1 minute for mobile, 30 seconds for desktop
      
      console.log(`üì± Real-time updates set to ${updateInterval/1000} seconds (${isMobile ? 'mobile' : 'desktop'})`);
      
      // Update interval
      realTimeInterval = setInterval(async () => {
        try {
          console.log('üîÑ Refreshing data...');
          
          // Track activity to prevent auto-logout
          trackActivity();
          
          // Mobile: Only refresh critical data
          if (isMobile) {
            console.log('üì± Mobile: Refreshing critical data only...');
            await Promise.all([
              loadSystemStats(),
              loadNewUsers()
            ]);
          } else {
            // Desktop: Refresh all data
            await Promise.all([
              loadSystemStats(),
              loadNewUsers()
            ]);
          }
          
          updateDashboard();
          console.log('‚úÖ Data refreshed successfully');
          
        } catch (error) {
          console.error('‚ùå Error refreshing data:', error);
        }
      }, updateInterval);
    }

    // Enhanced notification system
    function showNotification(message, type = 'info', duration = 5000) {
      const container = document.getElementById('notificationContainer');
      if (!container) return;
      
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div class="notification-content">
          <i class="fas ${getNotificationIcon(type)}"></i>
          <span>${message}</span>
        </div>
        <button class="notification-close" onclick="this.parentElement.remove()">
          <i class="fas fa-times"></i>
        </button>
      `;
      
      container.appendChild(notification);
      
      // Auto-remove after duration
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, duration);
      
      // Track activity
      trackActivity();
    }

    function getNotificationIcon(type) {
      const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
      };
      return icons[type] || icons.info;
    }

    // Enhanced error handling system
    class ErrorHandler {
      static handle(error, context = 'Unknown') {
        console.error(`‚ùå Error in ${context}:`, error);
        
        let message = 'An unexpected error occurred';
        let type = 'error';
        
        // Handle different error types
        if (error.name === 'TypeError') {
          message = 'Data format error. Please refresh the page.';
        } else if (error.name === 'NetworkError' || error.message.includes('fetch')) {
          message = 'Network connection error. Please check your internet.';
          type = 'warning';
        } else if (error.status === 401) {
          message = 'Session expired. Please login again.';
          setTimeout(() => logout(), 2000);
        } else if (error.status === 403) {
          message = 'Access denied. You don\'t have permission for this action.';
        } else if (error.status === 404) {
          message = 'Requested resource not found.';
        } else if (error.status >= 500) {
          message = 'Server error. Please try again later.';
        } else if (error.message) {
          message = error.message;
        }
        
        // Show user-friendly notification
        showNotification(message, type);
        
        // Track error for analytics
        this.trackError(error, context);
        
        // Log detailed error for debugging
        console.error('Error details:', {
          context,
          message: error.message,
          stack: error.stack,
          timestamp: new Date().toISOString()
        });
      }
      
      static trackError(error, context) {
        // In production, send to error tracking service
        const errorData = {
          context,
          message: error.message,
          stack: error.stack,
          userAgent: navigator.userAgent,
          timestamp: new Date().toISOString()
        };
        
        // Store in localStorage for debugging
        const errors = JSON.parse(localStorage.getItem('adminErrors') || '[]');
        errors.push(errorData);
        
        // Keep only last 50 errors
        if (errors.length > 50) {
          errors.shift();
        }
        
        localStorage.setItem('adminErrors', JSON.stringify(errors));
      }
      
      static async retryOperation(operation, maxRetries = 3, delay = 1000) {
        for (let attempt = 1; attempt <= maxRetries; attempt++) {
          try {
            return await operation();
          } catch (error) {
            if (attempt === maxRetries) {
              throw error;
            }
            
            console.warn(`‚ö†Ô∏è Attempt ${attempt} failed, retrying in ${delay}ms...`, error);
            await new Promise(resolve => setTimeout(resolve, delay));
            delay *= 2; // Exponential backoff
          }
        }
      }
    }

    // Enhanced API wrapper with error handling
    class ApiClient {
      static async request(endpoint, options = {}) {
        const url = `${API_BASE}${endpoint}`;
        const config = {
          headers: {
            'Content-Type': 'application/json',
            ...options.headers
          },
          ...options
        };
        
        // Add auth token if available
        if (adminToken) {
          config.headers.Authorization = `Bearer ${adminToken}`;
        }
        
        try {
          console.log(`üåê API Request: ${options.method || 'GET'} ${url}`);
          
          const response = await fetch(url, config);
          
          // Handle HTTP errors
          if (!response.ok) {
            const error = new Error(`HTTP ${response.status}: ${response.statusText}`);
            error.status = response.status;
            
            try {
              const errorData = await response.json();
              error.message = errorData.error || error.message;
            } catch {
              // If response is not JSON
            }
            
            throw error;
          }
          
          // Parse JSON response
          const data = await response.json();
          console.log(`‚úÖ API Response:`, data);
          
          return data;
          
        } catch (error) {
          console.error(`‚ùå API Error:`, error);
          throw error;
        }
      }
      
      static async get(endpoint) {
        return this.request(endpoint, { method: 'GET' });
      }
      
      static async post(endpoint, data) {
        return this.request(endpoint, {
          method: 'POST',
          body: JSON.stringify(data)
        });
      }
      
      static async put(endpoint, data) {
        return this.request(endpoint, {
          method: 'PUT',
          body: JSON.stringify(data)
        });
      }
      
      static async delete(endpoint) {
        return this.request(endpoint, { method: 'DELETE' });
      }
    }

    // Update admin info display
    function updateAdminInfo() {
      const adminNameElement = document.getElementById('currentAdminName');
      const adminRoleElement = document.getElementById('currentAdminRole');
      const adminEmailElement = document.getElementById('currentAdminEmail');
      
      if (adminNameElement) adminNameElement.textContent = currentAdmin.name || 'Admin';
      if (adminRoleElement) adminRoleElement.textContent = formatRole(currentAdmin.role) || 'Admin';
      if (adminEmailElement) adminEmailElement.textContent = currentAdmin.email || 'admin@nexchain.com';
    }

    // Format role for display
    function formatRole(role) {
      const formats = {
        'super_admin': 'Super Admin',
        'admin': 'Admin',
        'moderator': 'Moderator',
        'support': 'Support'
      };
      return formats[role] || role;
    }

    // Load system statistics
    async function loadSystemStats() {
      try {
        const response = await fetch(`${API_BASE}/admin/stats`, {
          headers: {
            'Authorization': `Bearer ${adminToken}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          systemStats = await response.json();
          console.log('üìä System stats loaded:', systemStats);
        } else {
          // Fallback - calculate from local data
          await calculateLocalStats();
        }
      } catch (error) {
        console.log('‚ö†Ô∏è Stats API not available, calculating locally...');
        await calculateLocalStats();
      }
    }

    // Calculate local statistics
    async function calculateLocalStats() {
      await loadAllUsers();
      await loadAllTransactions();
      
      systemStats = {
        totalUsers: allUsers.length,
        totalTransactions: allTransactions.length,
        totalStaked: allTransactions
          .filter(t => t.type === 'stake')
          .reduce((sum, t) => sum + parseFloat(t.amount || 0), 0),
        totalWithdrawals: allTransactions
          .filter(t => t.type === 'withdraw')
          .reduce((sum, t) => sum + parseFloat(t.amount || 0), 0),
        activeUsers: allUsers.filter(u => u.wallet_balance > 0).length,
        recentUsers: allUsers.filter(u => {
          const userDate = new Date(u.created_at);
          const weekAgo = new Date();
          weekAgo.setDate(weekAgo.getDate() - 7);
          return userDate > weekAgo;
        }).length
      };
    }

    // Load all users
    async function loadAllUsers() {
      try {
        showTableLoading('usersTableBody');
        
        const data = await ApiClient.get('/admin/users');
        allUsers = data;
        console.log('üë• Users loaded:', allUsers.length);
        updateUsersTable();
        
      } catch (error) {
        console.log('‚ö†Ô∏è Users API not available, using localStorage data...');
        // Load users from localStorage (includes wallet data from registration)
        const registeredUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
        allUsers = registeredUsers.map(user => ({
          id: user.email.replace(/[^a-zA-Z0-9]/g, ''),
          name: user.name,
          email: user.email,
          wallet_balance: parseFloat(user.balance || 0),
          staked_amount: 0,
          reward_balance: 0,
          status: user.status || 'active',
          wallet_address: user.walletAddress,
          public_key: user.publicKey,
          private_key: user.privateKey,
          created_at: user.createdAt,
          last_login: new Date().toISOString()
        }));
        updateUsersTable();
        
        // Use enhanced error handling for non-critical errors
        if (error.status !== 404) {
          ErrorHandler.handle(error, 'loadAllUsers');
        }
      }
    }

    // Load new users with verification codes
    async function loadNewUsers() {
      try {
        showTableLoading('newUsersTableBody');
        
        const data = await ApiClient.get('/admin/verification-codes');
        allNewUsers = data.codes || [];
        filteredNewUsers = [...allNewUsers];
        console.log('üîê New users with codes loaded:', allNewUsers.length);
        
        updatePagination();
        
      } catch (error) {
        console.log('‚ö†Ô∏è Verification codes API not available, using sample data...');
        allNewUsers = generateSampleVerificationCodes();
        filteredNewUsers = [...allNewUsers];
        updatePagination();
        
        // Use enhanced error handling for non-critical errors
        if (error.status !== 404) {
          ErrorHandler.handle(error, 'loadNewUsers');
        }
      }
    }

    // Generate sample verification codes
    function generateSampleVerificationCodes() {
      return [
        {
          id: 1,
          name: 'Ahmed Khan',
          email: 'ahmed@example.com',
          code: '123456',
          expires_at: new Date(Date.now() + 5 * 60 * 1000).toISOString(), // 5 minutes from now
          created_at: new Date(Date.now() - 2 * 60 * 1000).toISOString(), // 2 minutes ago
          status: 'pending'
        },
        {
          id: 2,
          name: 'Fatima Ali',
          email: 'fatima@example.com',
          code: '789012',
          expires_at: new Date(Date.now() + 8 * 60 * 1000).toISOString(), // 8 minutes from now
          created_at: new Date(Date.now() - 1 * 60 * 1000).toISOString(), // 1 minute ago
          status: 'pending'
        },
        {
          id: 3,
          name: 'Muhammad Hassan',
          email: 'hassan@example.com',
          code: '345678',
          expires_at: new Date(Date.now() + 3 * 60 * 1000).toISOString(), // 3 minutes from now
          created_at: new Date(Date.now() - 5 * 60 * 1000).toISOString(), // 5 minutes ago
          status: 'expired'
        }
      ];
    }

    // Render new users with verification codes
    function renderNewUsers(newUsers) {
      const tbody = document.getElementById('newUsersTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      
      newUsers.forEach(user => {
        const row = document.createElement('tr');
        const now = new Date();
        const expiresAt = new Date(user.expires_at);
        const timeLeft = expiresAt - now;
        const isExpired = timeLeft <= 0;
        
        row.innerHTML = `
          <td>${user.id}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #6366f1, #8b5cf6); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">
                ${user.name.charAt(0).toUpperCase()}
              </div>
              <span>${user.name}</span>
            </div>
          </td>
          <td>${user.email}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <code style="background: #f3f4f6; padding: 4px 8px; border-radius: 4px; font-weight: 600; color: #1f2937;">${user.code}</code>
              <button onclick="copyVerificationCode('${user.code}')" class="btn btn-sm" style="background: #10b981; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </td>
          <td>
            <span class="status-badge ${isExpired ? 'expired' : 'pending'}">
              ${isExpired ? 'Expired' : 'Pending'}
            </span>
          </td>
          <td>
            ${isExpired ? 'Expired' : formatTimeLeft(timeLeft)}
          </td>
          <td>${formatDateTime(user.created_at)}</td>
          <td>
            <div style="display: flex; gap: 4px;">
              <button onclick="resendVerificationCode('${user.email}')" class="btn btn-sm" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-redo"></i> Resend
              </button>
              <button onclick="deleteVerificationCode('${user.email}')" class="btn btn-sm" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Copy verification code to clipboard
    function copyVerificationCode(code) {
      navigator.clipboard.writeText(code).then(() => {
        showNotification(`Code ${code} copied to clipboard!`, 'success');
      }).catch(() => {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = code;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showNotification(`Code ${code} copied to clipboard!`, 'success');
      });
    }

    // Resend verification code
    async function resendVerificationCode(email) {
      try {
        showLoading(true, 'Resending verification code...');
        
        const data = await ApiClient.post('/admin/verification-codes/resend', { email });
        
        showLoading(false);
        showNotification(`Verification code resent to ${email}: ${data.code}`, 'success');
        console.log(`üîÑ Code resent: ${data.code}`);
        
        // Refresh the data
        await loadNewUsers();
        
      } catch (error) {
        showLoading(false);
        ErrorHandler.handle(error, 'resendVerificationCode');
      }
    }

    // Delete verification code
    async function deleteVerificationCode(email) {
      if (!confirm(`Are you sure you want to delete verification code for ${email}?`)) return;
      
      try {
        await ApiClient.delete(`/admin/verification-codes/${email}`);
        showNotification('Verification code deleted', 'success');
        
        // Refresh the data
        await loadNewUsers();
        
      } catch (error) {
        ErrorHandler.handle(error, 'deleteVerificationCode');
      }
    }

    // Load new user deposits
    async function loadNewUserDeposits() {
      try {
        showTableLoading('depositsTableBody');
        
        const data = await ApiClient.get('/admin/deposits');
        allDeposits = data.deposits || [];
        filteredDeposits = [...allDeposits];
        console.log('üí∞ New user deposits loaded:', allDeposits.length);
        
        updateDepositsPagination();
        
      } catch (error) {
        console.log('‚ö†Ô∏è Deposits API not available, using sample data...');
        allDeposits = generateSampleDeposits();
        filteredDeposits = [...allDeposits];
        updateDepositsPagination();
        
        // Use enhanced error handling for non-critical errors
        if (error.status !== 404) {
          ErrorHandler.handle(error, 'loadNewUserDeposits');
        }
      }
    }

    // Generate sample deposits
    function generateSampleDeposits() {
      return [
        {
          id: 1,
          user_name: 'Ahmed Khan',
          user_email: 'ahmed@example.com',
          amount: 1000.00,
          wallet_balance: 1250.75,
          reward_bonus: 50.00,
          referral: 'ref12345',
          status: 'confirmed',
          created_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString() // 2 hours ago
        },
        {
          id: 2,
          user_name: 'Fatima Ali',
          user_email: 'fatima@example.com',
          amount: 500.00,
          wallet_balance: 550.00,
          reward_bonus: 25.00,
          referral: 'ref67890',
          status: 'pending',
          created_at: new Date(Date.now() - 30 * 60 * 1000).toISOString() // 30 minutes ago
        },
        {
          id: 3,
          user_name: 'Muhammad Hassan',
          user_email: 'hassan@example.com',
          amount: 2500.00,
          wallet_balance: 2750.00,
          reward_bonus: 125.00,
          referral: null,
          status: 'confirmed',
          created_at: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString() // 4 hours ago
        },
        {
          id: 4,
          user_name: 'Sarah Johnson',
          user_email: 'sarah@example.com',
          amount: 750.00,
          wallet_balance: 0.00,
          reward_bonus: 0.00,
          referral: 'ref11111',
          status: 'failed',
          created_at: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString() // 6 hours ago
        }
      ];
    }

    // Render deposits table
    function renderDeposits(deposits) {
      const tbody = document.getElementById('depositsTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      
      deposits.forEach(deposit => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${deposit.id}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #10b981, #059669); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">
                ${deposit.user_name.charAt(0).toUpperCase()}
              </div>
              <span>${deposit.user_name}</span>
            </div>
          </td>
          <td>${deposit.user_email}</td>
          <td>
            <span style="color: #10b981; font-weight: 600;">
              $${parseFloat(deposit.amount || 0).toFixed(2)}
            </span>
          </td>
          <td>
            <span style="color: #3b82f6; font-weight: 600;">
              $${parseFloat(deposit.wallet_balance || 0).toFixed(2)}
            </span>
          </td>
          <td>
            <span style="color: #f59e0b; font-weight: 600;">
              $${parseFloat(deposit.reward_bonus || 0).toFixed(2)}
            </span>
          </td>
          <td>
            ${deposit.referral ? 
              `<code style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px; font-size: 12px;">${deposit.referral}</code>` : 
              '<span style="color: #9ca3af;">None</span>'
            }
          </td>
          <td>
            <span class="status-badge ${deposit.status}">
              ${deposit.status.charAt(0).toUpperCase() + deposit.status.slice(1)}
            </span>
          </td>
          <td>${formatDateTime(deposit.created_at)}</td>
          <td>
            <div style="display: flex; gap: 4px;">
              <button onclick="viewDepositDetails(${deposit.id})" class="btn btn-sm" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-eye"></i>
              </button>
              <button onclick="updateDepositStatus(${deposit.id})" class="btn btn-sm" style="background: #10b981; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-edit"></i>
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
      
      // Update count
      document.getElementById('depositsCount').textContent = `${deposits.length} deposits found`;
    }

    // Global variables for deposits
    let allDeposits = [];
    let filteredDeposits = [];
    let depositSortColumn = '';
    let depositSortDirection = 'asc';
    let depositCurrentPage = 1;
    let depositItemsPerPage = 10;

    // Deposits pagination functions
    function updateDepositsPagination() {
      const totalPages = Math.ceil(filteredDeposits.length / depositItemsPerPage);
      
      // Update page info
      document.getElementById('depositCurrentPage').textContent = depositCurrentPage;
      document.getElementById('depositTotalPages').textContent = totalPages || 1;
      
      // Update button states
      document.getElementById('depositPrevBtn').disabled = depositCurrentPage === 1;
      document.getElementById('depositNextBtn').disabled = depositCurrentPage === totalPages || totalPages === 0;
      
      // Render current page
      renderDepositsPage();
    }

    function renderDepositsPage() {
      const startIndex = (depositCurrentPage - 1) * depositItemsPerPage;
      const endIndex = startIndex + depositItemsPerPage;
      const pageData = filteredDeposits.slice(startIndex, endIndex);
      
      renderDeposits(pageData);
    }

    function previousDepositPage() {
      const totalPages = Math.ceil(filteredDeposits.length / depositItemsPerPage);
      if (depositCurrentPage > 1) {
        depositCurrentPage--;
        updateDepositsPagination();
        trackActivity();
      }
    }

    function nextDepositPage() {
      const totalPages = Math.ceil(filteredDeposits.length / depositItemsPerPage);
      if (depositCurrentPage < totalPages) {
        depositCurrentPage++;
        updateDepositsPagination();
        trackActivity();
      }
    }

    // Filter deposits
    function filterDeposits() {
      const statusFilter = document.getElementById('depositStatusFilter').value;
      const timeFilter = document.getElementById('depositTimeFilter').value;
      const searchTerm = document.getElementById('depositSearch').value.toLowerCase();
      
      filteredDeposits = allDeposits.filter(deposit => {
        // Status filter
        if (statusFilter && deposit.status !== statusFilter) return false;
        
        // Time filter
        if (timeFilter) {
          const depositTime = new Date(deposit.created_at);
          const now = new Date();
          let timeLimit;
          
          switch(timeFilter) {
            case '1h': timeLimit = now - (1 * 60 * 60 * 1000); break;
            case '24h': timeLimit = now - (24 * 60 * 60 * 1000); break;
            case '7d': timeLimit = now - (7 * 24 * 60 * 60 * 1000); break;
            case '30d': timeLimit = now - (30 * 24 * 60 * 60 * 1000); break;
          }
          
          if (timeLimit && depositTime < timeLimit) return false;
        }
        
        // Search filter
        if (searchTerm) {
          const searchableText = `${deposit.user_name} ${deposit.user_email} ${deposit.amount} ${deposit.referral}`.toLowerCase();
          if (!searchableText.includes(searchTerm)) return false;
        }
        
        return true;
      });
      
      // Reset pagination
      depositCurrentPage = 1;
      updateDepositsPagination();
    }

    // Sort deposits
    function sortDeposits(column) {
      if (depositSortColumn === column) {
        depositSortDirection = depositSortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        depositSortColumn = column;
        depositSortDirection = 'asc';
      }
      
      filteredDeposits.sort((a, b) => {
        let aVal = a[column];
        let bVal = b[column];
        
        // Handle numeric values
        if (column === 'amount' || column === 'wallet_balance' || column === 'reward_bonus') {
          aVal = parseFloat(aVal) || 0;
          bVal = parseFloat(bVal) || 0;
        }
        
        // Handle dates
        if (column === 'created_at') {
          aVal = new Date(aVal);
          bVal = new Date(bVal);
        }
        
        if (depositSortDirection === 'asc') {
          return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
        } else {
          return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
        }
      });
      
      updateDepositsPagination();
    }

    // View deposit details
    function viewDepositDetails(depositId) {
      const deposit = allDeposits.find(d => d.id === depositId);
      if (!deposit) return;
      
      alert(`Deposit Details:\n\n` +
            `User: ${deposit.user_name} (${deposit.user_email})\n` +
            `Amount: $${parseFloat(deposit.amount).toFixed(2)}\n` +
            `Wallet Balance: $${parseFloat(deposit.wallet_balance).toFixed(2)}\n` +
            `Reward Bonus: $${parseFloat(deposit.reward_bonus).toFixed(2)}\n` +
            `Referral: ${deposit.referral || 'None'}\n` +
            `Status: ${deposit.status}\n` +
            `Date: ${formatDateTime(deposit.created_at)}`);
    }

    // Update deposit status
    function updateDepositStatus(depositId) {
      const deposit = allDeposits.find(d => d.id === depositId);
      if (!deposit) return;
      
      const newStatus = prompt(`Update status for deposit ${depositId}:\n\n` +
                              `Current status: ${deposit.status}\n\n` +
                              `Enter new status (pending/confirmed/failed):`, 
                              deposit.status);
      
      if (newStatus && ['pending', 'confirmed', 'failed'].includes(newStatus.toLowerCase())) {
        deposit.status = newStatus.toLowerCase();
        filterDeposits(); // Refresh the table
        showNotification(`Deposit ${depositId} status updated to ${newStatus}`, 'success');
      } else if (newStatus) {
        showNotification('Invalid status. Use: pending, confirmed, or failed', 'error');
      }
    }

    // Load withdrawal requests
    async function loadWithdrawalRequests() {
      try {
        showTableLoading('withdrawalRequestsTableBody');
        
        const data = await ApiClient.get('/admin/withdrawal-requests');
        allWithdrawalRequests = data.withdrawalRequests || [];
        filteredWithdrawalRequests = [...allWithdrawalRequests];
        console.log('üí∞ Withdrawal requests loaded:', allWithdrawalRequests.length);
        
        updateWithdrawalPagination();
        
      } catch (error) {
        console.log('‚ö†Ô∏è Withdrawal requests API not available, using sample data...');
        allWithdrawalRequests = generateSampleWithdrawalRequests();
        filteredWithdrawalRequests = [...allWithdrawalRequests];
        updateWithdrawalPagination();
        
        // Use enhanced error handling for non-critical errors
        if (error.status !== 404) {
          ErrorHandler.handle(error, 'loadWithdrawalRequests');
        }
      }
    }

    // Generate sample withdrawal requests
    function generateSampleWithdrawalRequests() {
      return [
        {
          id: 1,
          user_name: 'Ahmed Khan',
          user_email: 'ahmed@example.com',
          withdrawal_amount: 500.00,
          wallet_balance: 1250.75,
          wallet_address: '0x1234...5678',
          status: 'pending',
          created_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString() // 2 hours ago
        },
        {
          id: 2,
          user_name: 'Fatima Ali',
          user_email: 'fatima@example.com',
          withdrawal_amount: 200.00,
          wallet_balance: 550.00,
          wallet_address: '0xabcd...efgh',
          status: 'approved',
          created_at: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString() // 6 hours ago
        },
        {
          id: 3,
          user_name: 'Muhammad Hassan',
          user_email: 'hassan@example.com',
          withdrawal_amount: 750.00,
          wallet_balance: 2750.00,
          wallet_address: '0x9876...5432',
          status: 'rejected',
          created_at: new Date(Date.now() - 12 * 60 * 60 * 1000).toISOString() // 12 hours ago
        },
        {
          id: 4,
          user_name: 'Sarah Johnson',
          user_email: 'sarah@example.com',
          withdrawal_amount: 150.00,
          wallet_balance: 0.00,
          wallet_address: '0xijkl...mnop',
          status: 'pending',
          created_at: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString() // 1 hour ago
        },
        {
          id: 5,
          user_name: 'Omar Farooq',
          user_email: 'omar@example.com',
          withdrawal_amount: 1000.00,
          wallet_balance: 3500.00,
          wallet_address: '0xqrst...uvwx',
          status: 'approved',
          created_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString() // 24 hours ago
        }
      ];
    }

    // Render withdrawal requests table
    function renderWithdrawalRequests(requests) {
      const tbody = document.getElementById('withdrawalRequestsTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      
      requests.forEach(request => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${request.id}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #10b981, #059669); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">
                ${request.user_name.charAt(0).toUpperCase()}
              </div>
              <span>${request.user_name}</span>
            </div>
          </td>
          <td>${request.user_email}</td>
          <td>
            <span style="color: #ef4444; font-weight: 600;">
              $${parseFloat(request.withdrawal_amount || 0).toFixed(2)}
            </span>
          </td>
          <td>
            <span style="color: #6b7280; font-weight: 600;">
              $${parseFloat(request.wallet_balance || 0).toFixed(2)}
            </span>
          </td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <code style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px; font-size: 12px; color: #6b7280; max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                ${request.wallet_address || 'N/A'}
              </code>
              <button onclick="copyWalletAddress('${request.wallet_address || ''}')" class="btn btn-sm" style="background: #8b5cf6; color: white; border: none; padding: 4px 6px; border-radius: 4px; cursor: pointer;" title="Copy Wallet Address">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </td>
          <td>
            <span class="status-badge ${request.status}">
              ${request.status.charAt(0).toUpperCase() + request.status.slice(1)}
            </span>
          </td>
          <td>${formatDateTime(request.created_at)}</td>
          <td>
            <div style="display: flex; gap: 4px;">
              <button onclick="viewWithdrawalDetails(${request.id})" class="btn btn-sm" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-eye"></i>
              </button>
              ${request.status === 'pending' ? `
                <button onclick="approveWithdrawalRequest(${request.id})" class="btn btn-sm" style="background: #10b981; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                  <i class="fas fa-check"></i>
                </button>
                <button onclick="rejectWithdrawalRequest(${request.id})" class="btn btn-sm" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                  <i class="fas fa-times"></i>
                </button>
              ` : ''}
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
      
      // Update count
      document.getElementById('withdrawalRequestsCount').textContent = `${requests.length} withdrawal requests found`;
    }

    // Global variables for withdrawal requests
    let allWithdrawalRequests = [];
    let filteredWithdrawalRequests = [];
    let withdrawalSortColumn = '';
    let withdrawalSortDirection = 'asc';
    let withdrawalCurrentPage = 1;
    let withdrawalItemsPerPage = 10;

    // Withdrawal requests pagination functions
    function updateWithdrawalPagination() {
      const totalPages = Math.ceil(filteredWithdrawalRequests.length / withdrawalItemsPerPage);
      
      // Update page info
      document.getElementById('withdrawalCurrentPage').textContent = withdrawalCurrentPage;
      document.getElementById('withdrawalTotalPages').textContent = totalPages || 1;
      
      // Update button states
      document.getElementById('withdrawalPrevBtn').disabled = withdrawalCurrentPage === 1;
      document.getElementById('withdrawalNextBtn').disabled = withdrawalCurrentPage === totalPages || totalPages === 0;
      
      // Render current page
      renderWithdrawalPage();
    }

    function renderWithdrawalPage() {
      const startIndex = (withdrawalCurrentPage - 1) * withdrawalItemsPerPage;
      const endIndex = startIndex + withdrawalItemsPerPage;
      const pageData = filteredWithdrawalRequests.slice(startIndex, endIndex);
      
      renderWithdrawalRequests(pageData);
    }

    function previousWithdrawalPage() {
      const totalPages = Math.ceil(filteredWithdrawalRequests.length / withdrawalItemsPerPage);
      if (withdrawalCurrentPage > 1) {
        withdrawalCurrentPage--;
        updateWithdrawalPagination();
        trackActivity();
      }
    }

    function nextWithdrawalPage() {
      const totalPages = Math.ceil(filteredWithdrawalRequests.length / withdrawalItemsPerPage);
      if (withdrawalCurrentPage < totalPages) {
        withdrawalCurrentPage++;
        updateWithdrawalPagination();
        trackActivity();
      }
    }

    // Filter withdrawal requests
    function filterWithdrawalRequests() {
      const statusFilter = document.getElementById('withdrawalStatusFilter').value;
      const timeFilter = document.getElementById('withdrawalTimeFilter').value;
      const searchTerm = document.getElementById('withdrawalSearch').value.toLowerCase();
      
      filteredWithdrawalRequests = allWithdrawalRequests.filter(request => {
        // Status filter
        if (statusFilter && request.status !== statusFilter) return false;
        
        // Time filter
        if (timeFilter) {
          const requestTime = new Date(request.created_at);
          const now = new Date();
          let timeLimit;
          
          switch(timeFilter) {
            case '1h': timeLimit = now - (1 * 60 * 60 * 1000); break;
            case '24h': timeLimit = now - (24 * 60 * 60 * 1000); break;
            case '7d': timeLimit = now - (7 * 24 * 60 * 60 * 1000); break;
            case '30d': timeLimit = now - (30 * 24 * 60 * 60 * 1000); break;
          }
          
          if (timeLimit && requestTime < timeLimit) return false;
        }
        
        // Search filter
        if (searchTerm) {
          const searchableText = `${request.user_name} ${request.user_email} ${request.withdrawal_amount} ${request.wallet_balance} ${request.wallet_address}`.toLowerCase();
          if (!searchableText.includes(searchTerm)) return false;
        }
        
        return true;
      });
      
      // Reset pagination
      withdrawalCurrentPage = 1;
      updateWithdrawalPagination();
    }

    // Sort withdrawal requests
    function sortWithdrawalRequests(column) {
      if (withdrawalSortColumn === column) {
        withdrawalSortDirection = withdrawalSortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        withdrawalSortColumn = column;
        withdrawalSortDirection = 'asc';
      }
      
      filteredWithdrawalRequests.sort((a, b) => {
        let aVal = a[column];
        let bVal = b[column];
        
        // Handle numeric values
        if (column === 'withdrawal_amount' || column === 'wallet_balance') {
          aVal = parseFloat(aVal) || 0;
          bVal = parseFloat(bVal) || 0;
        }
        
        // Handle wallet address (string comparison)
        if (column === 'wallet_address') {
          aVal = aVal || '';
          bVal = bVal || '';
        }
        
        // Handle dates
        if (column === 'created_at') {
          aVal = new Date(aVal);
          bVal = new Date(bVal);
        }
        
        if (withdrawalSortDirection === 'asc') {
          return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
        } else {
          return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
        }
      });
      
      updateWithdrawalPagination();
    }

    // View withdrawal details
    function viewWithdrawalDetails(requestId) {
      const request = allWithdrawalRequests.find(r => r.id === requestId);
      if (!request) return;
      
      alert(`Withdrawal Request Details:\n\n` +
            `User: ${request.user_name} (${request.user_email})\n` +
            `Withdrawal Amount: $${parseFloat(request.withdrawal_amount).toFixed(2)}\n` +
            `Wallet Balance: $${parseFloat(request.wallet_balance).toFixed(2)}\n` +
            `Wallet Address: ${request.wallet_address || 'N/A'}\n` +
            `Status: ${request.status}\n` +
            `Date: ${formatDateTime(request.created_at)}`);
    }

    // Approve withdrawal request
    function approveWithdrawalRequest(requestId) {
      const request = allWithdrawalRequests.find(r => r.id === requestId);
      if (!request) return;
      
      if (confirm(`Are you sure you want to approve this withdrawal request?\n\n` +
                 `User: ${request.user_name}\n` +
                 `Amount: $${parseFloat(request.withdrawal_amount).toFixed(2)}\n` +
                 `Wallet Balance: $${parseFloat(request.wallet_balance).toFixed(2)}\n` +
                 `Wallet Address: ${request.wallet_address || 'N/A'}`)) {
        
        // Update status
        request.status = 'approved';
        
        // Refresh the table
        filterWithdrawalRequests();
        
        // Show notification
        showNotification(`Withdrawal request ${requestId} approved for ${request.user_name}`, 'success');
        
        // In production, this would make an API call
        console.log(`‚úÖ Approved withdrawal request ${requestId}`);
      }
    }

    // Reject withdrawal request
    function rejectWithdrawalRequest(requestId) {
      const request = allWithdrawalRequests.find(r => r.id === requestId);
      if (!request) return;
      
      if (confirm(`Are you sure you want to reject this withdrawal request?\n\n` +
                 `User: ${request.user_name}\n` +
                 `Amount: $${parseFloat(request.withdrawal_amount).toFixed(2)}\n` +
                 `Wallet Balance: $${parseFloat(request.wallet_balance).toFixed(2)}\n` +
                 `Wallet Address: ${request.wallet_address || 'N/A'}`)) {
        
        // Update status
        request.status = 'rejected';
        
        // Refresh the table
        filterWithdrawalRequests();
        
        // Show notification
        showNotification(`Withdrawal request ${requestId} rejected for ${request.user_name}`, 'warning');
        
        // In production, this would make an API call
        console.log(`‚ùå Rejected withdrawal request ${requestId}`);
      }
    }

    // Copy wallet address to clipboard
    function copyWalletAddress(walletAddress) {
      if (!walletAddress || walletAddress === 'N/A') {
        showNotification('No wallet address available', 'warning');
        return;
      }
      
      // Create a temporary textarea to copy the address
      const tempTextArea = document.createElement('textarea');
      tempTextArea.value = walletAddress;
      tempTextArea.style.position = 'fixed';
      tempTextArea.style.opacity = '0';
      document.body.appendChild(tempTextArea);
      
      try {
        // Select and copy the text
        tempTextArea.select();
        const successful = document.execCommand('copy');
        
        if (successful) {
          showNotification(`Wallet address copied: ${walletAddress}`, 'success');
          console.log(`üìã Copied wallet address: ${walletAddress}`);
        } else {
          // Fallback for modern browsers
          navigator.clipboard.writeText(walletAddress).then(() => {
            showNotification(`Wallet address copied: ${walletAddress}`, 'success');
            console.log(`üìã Copied wallet address: ${walletAddress}`);
          }).catch(err => {
            console.error('‚ùå Failed to copy wallet address:', err);
            showNotification('Failed to copy wallet address', 'error');
          });
        }
      } catch (err) {
        console.error('‚ùå Failed to copy wallet address:', err);
        showNotification('Failed to copy wallet address', 'error');
      } finally {
        // Remove the temporary textarea
        document.body.removeChild(tempTextArea);
      }
    }

    // Mobile Optimizations
    function initializeMobileOptimizations() {
      // Check if mobile device
      const isMobile = window.innerWidth <= 768;
      
      if (isMobile) {
        console.log('üì± Initializing mobile optimizations...');
        
        // Add touch-friendly interactions
        addTouchOptimizations();
        
        // Optimize table scrolling
        optimizeTableScrolling();
        
        // Handle mobile-specific UI
        handleMobileUI();
        
        // Add mobile gesture support
        addMobileGestures();
        
        // Mobile performance optimizations
        optimizeMobilePerformance();
        
        // Reduce visual effects on mobile
        reduceMobileAnimations();
      }
    }

    // Mobile performance optimizations
    function optimizeMobilePerformance() {
      console.log('‚ö° Optimizing mobile performance...');
      
      // Reduce sample data size for mobile
      const originalGenerateSampleUsers = window.generateSampleUsers;
      if (originalGenerateSampleUsers) {
        window.generateSampleUsers = function() {
          const users = originalGenerateSampleUsers();
          // Return fewer users on mobile
          return users.slice(0, Math.min(10, users.length));
        };
      }
      
      // Reduce sample data for other functions too
      const originalGenerateSampleDeposits = window.generateSampleDeposits;
      if (originalGenerateSampleDeposits) {
        window.generateSampleDeposits = function() {
          const deposits = originalGenerateSampleDeposits();
          return deposits.slice(0, Math.min(8, deposits.length));
        };
      }
      
      const originalGenerateSampleWithdrawalRequests = window.generateSampleWithdrawalRequests;
      if (originalGenerateSampleWithdrawalRequests) {
        window.generateSampleWithdrawalRequests = function() {
          const requests = originalGenerateSampleWithdrawalRequests();
          return requests.slice(0, Math.min(8, requests.length));
        };
      }
      
      // Optimize table rendering
      const tables = document.querySelectorAll('table');
      tables.forEach(table => {
        // Add virtual scrolling hint
        table.style.transform = 'translateZ(0)';
        table.style.willChange = 'transform';
      });
      
      // Reduce DOM updates
      let updateTimeout;
      const originalUpdateDashboard = window.updateDashboard;
      if (originalUpdateDashboard) {
        window.updateDashboard = function() {
          clearTimeout(updateTimeout);
          updateTimeout = setTimeout(() => {
            originalUpdateDashboard();
          }, 100); // Debounce updates
        };
      }
      
      // Disable heavy animations on mobile
      document.body.classList.add('mobile-performance-mode');
    }

    // Reduce animations on mobile for better performance
    function reduceMobileAnimations() {
      console.log('üé® Reducing mobile animations...');
      
      // Add CSS for reduced animations
      const style = document.createElement('style');
      style.textContent = `
        .mobile-performance-mode * {
          animation-duration: 0.1s !important;
          transition-duration: 0.1s !important;
        }
        
        .mobile-performance-mode .loading-spinner {
          animation: spin 1s linear infinite !important;
        }
        
        .mobile-performance-mode .btn {
          transition: none !important;
        }
        
        .mobile-performance-mode .status-badge {
          transition: none !important;
        }
        
        .mobile-performance-mode .notification {
          animation: slideIn 0.2s ease-out !important;
        }
        
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
          from { 
            transform: translateY(-20px);
            opacity: 0;
          }
          to { 
            transform: translateY(0);
            opacity: 1;
          }
        }
      `;
      document.head.appendChild(style);
    }

    // Mobile network optimization
    function optimizeMobileNetwork() {
      console.log('üì° Optimizing mobile network...');
      
      // Add network status detection
      if ('connection' in navigator) {
        const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
        
        if (connection) {
          console.log('üì± Network type:', connection.effectiveType);
          console.log('üì± Save data mode:', connection.saveData);
          
          // Adjust loading based on network quality
          if (connection.saveData || connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {
            console.log('üêå Slow network detected - reducing data usage...');
            
            // Further reduce data on slow networks
            const originalGenerateSampleUsers = window.generateSampleUsers;
            if (originalGenerateSampleUsers) {
              window.generateSampleUsers = function() {
                const users = originalGenerateSampleUsers();
                return users.slice(0, 5); // Even fewer users on slow networks
              };
            }
            
            // Increase real-time update interval
            if (realTimeInterval) {
              clearInterval(realTimeInterval);
              realTimeInterval = setInterval(async () => {
                try {
                  await loadSystemStats();
                  updateDashboard();
                } catch (error) {
                  console.error('‚ùå Error refreshing data:', error);
                }
              }, 120000); // 2 minutes on very slow networks
            }
          }
        }
      }
    }

    // Add network optimization to mobile initialization
    function addTouchOptimizations() {
      // Make buttons larger for touch
      const buttons = document.querySelectorAll('.btn, .btn-sm');
      buttons.forEach(button => {
        button.style.minHeight = '44px'; // iOS touch target minimum
        button.style.minWidth = '44px';
      });
      
      // Add ripple effect for touch feedback
      buttons.forEach(button => {
        button.addEventListener('touchstart', function(e) {
          this.style.transform = 'scale(0.95)';
        });
        
        button.addEventListener('touchend', function(e) {
          this.style.transform = 'scale(1)';
        });
      });
      
      // Add network optimization
      optimizeMobileNetwork();
    }

    // Optimize table scrolling for mobile
    function optimizeTableScrolling() {
      const tableContainers = document.querySelectorAll('.table-responsive');
      
      tableContainers.forEach(container => {
        // Add scroll indicators
        container.addEventListener('scroll', function() {
          const hasHorizontalScroll = this.scrollWidth > this.clientWidth;
          const scrolledToEnd = this.scrollLeft + this.clientWidth >= this.scrollWidth - 1;
          const scrolledToStart = this.scrollLeft === 0;
          
          if (hasHorizontalScroll) {
            if (!scrolledToEnd && !scrolledToStart) {
              this.classList.add('scrolling-middle');
            } else if (scrolledToEnd) {
              this.classList.add('scrolling-end');
              this.classList.remove('scrolling-middle');
            } else {
              this.classList.add('scrolling-start');
              this.classList.remove('scrolling-middle');
            }
          }
        });
        
        // Add momentum scrolling
        container.style.webkitOverflowScrolling = 'touch';
        container.style.scrollBehavior = 'smooth';
      });
    }

    // Handle mobile-specific UI
    function handleMobileUI() {
      // Collapse sidebar on mobile by default
      const sidebar = document.querySelector('.sidebar');
      if (sidebar) {
        sidebar.classList.add('mobile-collapsed');
      }
      
      // Add mobile menu toggle
      addMobileMenuToggle();
      
      // Optimize modals for mobile
      optimizeModalsForMobile();
      
      // Handle virtual keyboard
      handleVirtualKeyboard();
    }

    // Add mobile menu toggle
    function addMobileMenuToggle() {
      const header = document.querySelector('.admin-header');
      if (header && !document.querySelector('.mobile-menu-toggle')) {
        const toggleBtn = document.createElement('button');
        toggleBtn.className = 'mobile-menu-toggle';
        toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
        toggleBtn.style.cssText = `
          position: absolute;
          top: 1rem;
          left: 1rem;
          background: #4f46e5;
          color: white;
          border: none;
          border-radius: 8px;
          padding: 0.5rem;
          font-size: 1rem;
          cursor: pointer;
          z-index: 1000;
        `;
        
        header.style.position = 'relative';
        header.appendChild(toggleBtn);
        
        toggleBtn.addEventListener('click', function() {
          const sidebar = document.querySelector('.sidebar');
          if (sidebar) {
            sidebar.classList.toggle('mobile-collapsed');
          }
        });
      }
    }

    // Optimize modals for mobile
    function optimizeModalsForMobile() {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        modal.style.maxHeight = '90vh';
        modal.style.overflowY = 'auto';
      });
    }

    // Handle virtual keyboard
    function handleVirtualKeyboard() {
      const inputs = document.querySelectorAll('input, textarea');
      
      inputs.forEach(input => {
        input.addEventListener('focus', function() {
          // Scroll input into view when keyboard appears
          setTimeout(() => {
            this.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }, 300);
        });
      });
    }

    // Add mobile gesture support
    function addMobileGestures() {
      let touchStartX = 0;
      let touchEndX = 0;
      
      // Add swipe gestures for tables
      const tableContainers = document.querySelectorAll('.table-responsive');
      
      tableContainers.forEach(container => {
        container.addEventListener('touchstart', function(e) {
          touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });
        
        container.addEventListener('touchend', function(e) {
          touchEndX = e.changedTouches[0].screenX;
          handleSwipeGesture(this, touchStartX, touchEndX);
        }, { passive: true });
      });
    }

    // Handle swipe gesture
    function handleSwipeGesture(element, startX, endX) {
      const swipeThreshold = 50;
      const diff = startX - endX;
      
      if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0) {
          // Swipe left - scroll right
          element.scrollBy({ left: 200, behavior: 'smooth' });
        } else {
          // Swipe right - scroll left
          element.scrollBy({ left: -200, behavior: 'smooth' });
        }
      }
    }

    // Optimize notifications for mobile
    function optimizeMobileNotifications() {
      const notifications = document.querySelectorAll('.notification');
      notifications.forEach(notification => {
        notification.style.position = 'fixed';
        notification.style.top = '10px';
        notification.style.left = '10px';
        notification.style.right = '10px';
        notification.style.width = 'auto';
        notification.style.maxWidth = 'none';
        notification.style.zIndex = '9999';
      });
    }

    // Handle orientation changes
    function handleOrientationChange() {
      window.addEventListener('orientationchange', function() {
        setTimeout(() => {
          // Refresh UI after orientation change
          window.dispatchEvent(new Event('resize'));
        }, 100);
      });
    }

    // Initialize all mobile optimizations
    document.addEventListener('DOMContentLoaded', function() {
      initializeMobileOptimizations();
      handleOrientationChange();
      
      // Re-initialize on window resize
      window.addEventListener('resize', function() {
        if (window.innerWidth <= 768) {
          initializeMobileOptimizations();
        }
      });
    });

    // Add mobile-specific CSS classes dynamically
    function addMobileCSSClasses() {
      const style = document.createElement('style');
      style.textContent = `
        /* Mobile scroll indicators */
        .table-responsive::before,
        .table-responsive::after {
          content: '';
          position: absolute;
          top: 0;
          bottom: 0;
          width: 20px;
          pointer-events: none;
          z-index: 1;
          opacity: 0;
          transition: opacity 0.3s;
        }
        
        .table-responsive::before {
          left: 0;
          background: linear-gradient(90deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%);
        }
        
        .table-responsive::after {
          right: 0;
          background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
        }
        
        .table-responsive.scrolling-start::before {
          opacity: 0;
        }
        
        .table-responsive.scrolling-end::after {
          opacity: 0;
        }
        
        .table-responsive.scrolling-middle::before,
        .table-responsive.scrolling-middle::after {
          opacity: 1;
        }
        
        /* Mobile sidebar */
        .sidebar.mobile-collapsed {
          transform: translateX(-100%);
          transition: transform 0.3s ease;
        }
        
        .sidebar.mobile-collapsed.mobile-open {
          transform: translateX(0);
        }
        
        /* Mobile touch feedback */
        .btn:active {
          transform: scale(0.95);
        }
        
        /* Mobile loading */
        @media (max-width: 768px) {
          .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            z-index: 9999;
          }
        }
      `;
      document.head.appendChild(style);
    }

    // Add mobile CSS classes
    addMobileCSSClasses();

    // Global variables for filtering
    let allNewUsers = [];
    let filteredNewUsers = [];
    let sortColumn = '';
    let sortDirection = 'asc';
    
    // Pagination variables
    let currentPage = 1;
    let itemsPerPage = 10;
    let selectedUsers = new Set();

    // Pagination functions
    function updatePagination() {
      const totalPages = Math.ceil(filteredNewUsers.length / itemsPerPage);
      
      // Update page info
      document.getElementById('currentPage').textContent = currentPage;
      document.getElementById('totalPages').textContent = totalPages || 1;
      
      // Update button states
      document.getElementById('prevBtn').disabled = currentPage === 1;
      document.getElementById('nextBtn').disabled = currentPage === totalPages || totalPages === 0;
      
      // Render current page
      renderPaginatedUsers();
    }

    function renderPaginatedUsers() {
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const pageData = filteredNewUsers.slice(startIndex, endIndex);
      
      renderNewUsersPage(pageData);
    }

    function nextPage() {
      const totalPages = Math.ceil(filteredNewUsers.length / itemsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        updatePagination();
        trackActivity();
      }
    }

    function previousPage() {
      if (currentPage > 1) {
        currentPage--;
        updatePagination();
        trackActivity();
      }
    }

    function goToPage(page) {
      const totalPages = Math.ceil(filteredNewUsers.length / itemsPerPage);
      if (page >= 1 && page <= totalPages) {
        currentPage = page;
        updatePagination();
        trackActivity();
      }
    }

    // Bulk operations functions
    function selectAllNewUsers() {
      const checkboxes = document.querySelectorAll('.user-checkbox');
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      
      checkboxes.forEach(checkbox => {
        checkbox.checked = !allChecked;
        const userId = checkbox.dataset.userId;
        if (!allChecked) {
          selectedUsers.add(userId);
        } else {
          selectedUsers.delete(userId);
        }
      });
      
      updateBulkActionsUI();
      showNotification(allChecked ? 'Deselected all users' : 'Selected all users', 'info');
    }

    function toggleUserSelection(userId) {
      if (selectedUsers.has(userId)) {
        selectedUsers.delete(userId);
      } else {
        selectedUsers.add(userId);
      }
      updateBulkActionsUI();
    }

    function updateBulkActionsUI() {
      const bulkActions = document.querySelector('.bulk-actions');
      const hasSelection = selectedUsers.size > 0;
      
      bulkActions.style.opacity = hasSelection ? '1' : '0.5';
      bulkActions.style.pointerEvents = hasSelection ? 'auto' : 'none';
      
      // Update select all button text
      const selectAllBtn = document.querySelector('.bulk-actions button:first-child');
      const totalUsers = filteredNewUsers.length;
      if (selectedUsers.size === totalUsers && totalUsers > 0) {
        selectAllBtn.innerHTML = '<i class="fas fa-square"></i> Deselect All';
      } else {
        selectAllBtn.innerHTML = '<i class="fas fa-check-square"></i> Select All';
      }
    }

    async function bulkResendCodes() {
      if (selectedUsers.size === 0) {
        showNotification('Please select users to resend codes', 'warning');
        return;
      }
      
      if (!confirm(`Resend verification codes to ${selectedUsers.size} user(s)?`)) {
        return;
      }
      
      showLoading(true, `Resending codes to ${selectedUsers.size} users...`);
      
      try {
        let successCount = 0;
        let errorCount = 0;
        
        for (const userId of selectedUsers) {
          try {
            const user = allNewUsers.find(u => u.id == userId);
            if (user) {
              await resendVerificationCode(user.email);
              successCount++;
            }
          } catch (error) {
            errorCount++;
            console.error(`Failed to resend to user ${userId}:`, error);
          }
        }
        
        showLoading(false);
        
        if (successCount > 0) {
          showNotification(`Successfully resent ${successCount} code(s)`, 'success');
        }
        if (errorCount > 0) {
          showNotification(`Failed to resend ${errorCount} code(s)`, 'error');
        }
        
        // Clear selection
        selectedUsers.clear();
        updateBulkActionsUI();
        
      } catch (error) {
        showLoading(false);
        ErrorHandler.handle(error, 'bulkResendCodes');
      }
    }

    async function bulkDeleteCodes() {
      if (selectedUsers.size === 0) {
        showNotification('Please select users to delete codes', 'warning');
        return;
      }
      
      if (!confirm(`Delete verification codes for ${selectedUsers.size} user(s)? This action cannot be undone.`)) {
        return;
      }
      
      showLoading(true, `Deleting codes for ${selectedUsers.size} users...`);
      
      try {
        let successCount = 0;
        let errorCount = 0;
        
        for (const userId of selectedUsers) {
          try {
            await deleteVerificationCode(userId);
            successCount++;
          } catch (error) {
            errorCount++;
            console.error(`Failed to delete code for user ${userId}:`, error);
          }
        }
        
        showLoading(false);
        
        if (successCount > 0) {
          showNotification(`Successfully deleted ${successCount} code(s)`, 'success');
        }
        if (errorCount > 0) {
          showNotification(`Failed to delete ${errorCount} code(s)`, 'error');
        }
        
        // Clear selection and refresh data
        selectedUsers.clear();
        updateBulkActionsUI();
        await loadNewUsers();
        
      } catch (error) {
        showLoading(false);
        ErrorHandler.handle(error, 'bulkDeleteCodes');
      }
    }

    // Update renderNewUsers to support pagination and checkboxes
    function renderNewUsersPage(pageData) {
      const tbody = document.getElementById('newUsersTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      
      if (pageData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="9" style="text-align: center; padding: 40px; color: #6b7280;">
              <div class="empty-state">
                <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <p>No users found matching your criteria</p>
                <button onclick="clearFilters()" class="btn btn-sm" style="margin-top: 1rem;">
                  Clear Filters
                </button>
              </div>
            </td>
          </tr>
        `;
        return;
      }
      
      pageData.forEach(user => {
        const row = document.createElement('tr');
        const now = new Date();
        const expiresAt = new Date(user.expires_at);
        const timeLeft = expiresAt - now;
        const isExpired = timeLeft <= 0;
        const isSelected = selectedUsers.has(user.id.toString());
        
        row.innerHTML = `
          <td>
            <input type="checkbox" class="user-checkbox" data-user-id="${user.id}" 
                   onchange="toggleUserSelection('${user.id}')" ${isSelected ? 'checked' : ''}>
          </td>
          <td>${user.id}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #6366f1, #8b5cf6); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">
                ${user.name.charAt(0).toUpperCase()}
              </div>
              <span>${user.name}</span>
            </div>
          </td>
          <td>${user.email}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <code style="background: #f3f4f6; padding: 4px 8px; border-radius: 4px; font-weight: 600; color: #1f2937;">${user.code}</code>
              <button onclick="copyVerificationCode('${user.code}')" class="btn btn-sm" style="background: #10b981; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </td>
          <td>
            <span class="status-badge ${isExpired ? 'expired' : 'pending'}">
              ${isExpired ? 'Expired' : 'Pending'}
            </span>
          </td>
          <td>
            ${isExpired ? 'Expired' : formatTimeLeft(timeLeft)}
          </td>
          <td>${formatDateTime(user.created_at)}</td>
          <td>
            <div style="display: flex; gap: 4px;">
              <button onclick="resendVerificationCode('${user.email}')" class="btn btn-sm" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-redo"></i> Resend
              </button>
              <button onclick="deleteVerificationCode('${user.email}')" class="btn btn-sm" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
      
      updateResultsCount();
    }

    // Advanced filtering function
    function filterNewUsers() {
      const searchTerm = document.getElementById('newUserSearch').value.toLowerCase();
      const statusFilter = document.getElementById('statusFilter').value;
      const timeFilter = document.getElementById('timeFilter').value;
      
      filteredNewUsers = allNewUsers.filter(user => {
        // Search filter
        const matchesSearch = !searchTerm || 
          user.name.toLowerCase().includes(searchTerm) ||
          user.email.toLowerCase().includes(searchTerm) ||
          user.code.includes(searchTerm);
        
        // Status filter
        const matchesStatus = !statusFilter || user.status === statusFilter;
        
        // Time filter
        let matchesTime = true;
        if (timeFilter) {
          const now = new Date();
          const userTime = new Date(user.created_at);
          
          switch(timeFilter) {
            case '1h':
              matchesTime = (now - userTime) <= (60 * 60 * 1000);
              break;
            case '24h':
              matchesTime = (now - userTime) <= (24 * 60 * 60 * 1000);
              break;
            case '7d':
              matchesTime = (now - userTime) <= (7 * 24 * 60 * 60 * 1000);
              break;
          }
        }
        
        return matchesSearch && matchesStatus && matchesTime;
      });
      
      // Reset to first page when filtering
      currentPage = 1;
      selectedUsers.clear();
      
      // Apply current sorting
      if (sortColumn) {
        sortNewUsers(sortColumn, sortDirection);
      } else {
        updatePagination();
      }
      
      updateResultsCount();
      updateBulkActionsUI();
      trackActivity();
    }

    // Sort table function
    function sortTable(table, column) {
      if (table === 'newUsers') {
        const newDirection = sortColumn === column && sortDirection === 'asc' ? 'desc' : 'asc';
        sortNewUsers(column, newDirection);
      }
    }

    // Sort new users
    function sortNewUsers(column, direction) {
      sortColumn = column;
      sortDirection = direction;
      
      filteredNewUsers.sort((a, b) => {
        let aVal = a[column];
        let bVal = b[column];
        
        // Handle dates
        if (column.includes('_at')) {
          aVal = new Date(aVal);
          bVal = new Date(bVal);
        }
        
        // Handle numbers
        if (column === 'id') {
          aVal = parseInt(aVal);
          bVal = parseInt(bVal);
        }
        
        if (aVal < bVal) return direction === 'asc' ? -1 : 1;
        if (aVal > bVal) return direction === 'asc' ? 1 : -1;
        return 0;
      });
      
      renderFilteredNewUsers();
    }

    // Render filtered new users
    function renderFilteredNewUsers() {
      renderNewUsers(filteredNewUsers);
    }

    // Update results count
    function updateResultsCount() {
      const countElement = document.getElementById('newUsersResultsCount');
      if (countElement) {
        const total = allNewUsers.length;
        const filtered = filteredNewUsers.length;
        countElement.textContent = `${filtered} of ${total} results`;
      }
    }

    // Clear all filters
    function clearFilters() {
      document.getElementById('newUserSearch').value = '';
      document.getElementById('statusFilter').value = '';
      document.getElementById('timeFilter').value = '';
      
      filteredNewUsers = [...allNewUsers];
      sortColumn = '';
      sortDirection = 'asc';
      
      renderFilteredNewUsers();
      updateResultsCount();
      showNotification('Filters cleared', 'info');
    }

    // Export filtered data
    function exportFilteredNewUsers() {
      if (filteredNewUsers.length === 0) {
        showNotification('No data to export', 'warning');
        return;
      }
      
      const csvContent = [
        ['ID', 'Name', 'Email', 'Code', 'Status', 'Expires At', 'Created At'],
        ...filteredNewUsers.map(user => [
          user.id,
          user.name,
          user.email,
          user.code,
          user.status,
          user.expires_at,
          user.created_at
        ])
      ].map(row => row.join(',')).join('\n');
      
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `new-users-filtered-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
      
      showNotification(`Exported ${filteredNewUsers.length} records`, 'success');
    }

    // Update renderNewUsers to use filtered data
    function renderNewUsers(newUsers) {
      allNewUsers = newUsers;
      if (filteredNewUsers.length === 0) {
        filteredNewUsers = [...allNewUsers];
      }
      
      const tbody = document.getElementById('newUsersTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      
      if (filteredNewUsers.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; padding: 40px; color: #6b7280;">
              <div class="empty-state">
                <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <p>No users found matching your criteria</p>
                <button onclick="clearFilters()" class="btn btn-sm" style="margin-top: 1rem;">
                  Clear Filters
                </button>
              </div>
            </td>
          </tr>
        `;
        return;
      }
      
      filteredNewUsers.forEach(user => {
        const row = document.createElement('tr');
        const now = new Date();
        const expiresAt = new Date(user.expires_at);
        const timeLeft = expiresAt - now;
        const isExpired = timeLeft <= 0;
        
        row.innerHTML = `
          <td>${user.id}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #6366f1, #8b5cf6); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">
                ${user.name.charAt(0).toUpperCase()}
              </div>
              <span>${user.name}</span>
            </div>
          </td>
          <td>${user.email}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <code style="background: #f3f4f6; padding: 4px 8px; border-radius: 4px; font-weight: 600; color: #1f2937;">${user.code}</code>
              <button onclick="copyVerificationCode('${user.code}')" class="btn btn-sm" style="background: #10b981; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </td>
          <td>
            <span class="status-badge ${isExpired ? 'expired' : 'pending'}">
              ${isExpired ? 'Expired' : 'Pending'}
            </span>
          </td>
          <td>
            ${isExpired ? 'Expired' : formatTimeLeft(timeLeft)}
          </td>
          <td>${formatDateTime(user.created_at)}</td>
          <td>
            <div style="display: flex; gap: 4px;">
              <button onclick="resendVerificationCode('${user.email}')" class="btn btn-sm" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-redo"></i> Resend
              </button>
              <button onclick="deleteVerificationCode('${user.email}')" class="btn btn-sm" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
      
      updateResultsCount();
    }

    // Format time left
    function formatTimeLeft(milliseconds) {
      if (milliseconds <= 0) return 'Expired';
      
      const minutes = Math.floor(milliseconds / 60000);
      const seconds = Math.floor((milliseconds % 60000) / 1000);
      
      if (minutes > 0) {
        return `${minutes}m ${seconds}s`;
      } else {
        return `${seconds}s`;
      }
    }

    // Analytics Chart Variables
    let userGrowthChart, transactionChart, revenueChart, activityChart;

    // Initialize Analytics Dashboard
    function initAnalytics() {
      // Initialize User Growth Chart
      const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
      userGrowthChart = new Chart(userGrowthCtx, {
        type: 'line',
        data: {
          labels: generateDateLabels(7),
          datasets: [{
            label: 'New Users',
            data: generateRandomData(7, 10, 50),
            borderColor: '#6366f1',
            backgroundColor: 'rgba(99, 102, 241, 0.1)',
            tension: 0.4,
            fill: true
          }, {
            label: 'Active Users',
            data: generateRandomData(7, 100, 500),
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      // Initialize Transaction Chart
      const transactionCtx = document.getElementById('transactionChart').getContext('2d');
      transactionChart = new Chart(transactionCtx, {
        type: 'bar',
        data: {
          labels: generateDateLabels(7),
          datasets: [{
            label: 'Deposits',
            data: generateRandomData(7, 1000, 5000),
            backgroundColor: '#6366f1'
          }, {
            label: 'Withdrawals',
            data: generateRandomData(7, 500, 2000),
            backgroundColor: '#ef4444'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      // Initialize Revenue Chart
      const revenueCtx = document.getElementById('revenueChart').getContext('2d');
      revenueChart = new Chart(revenueCtx, {
        type: 'line',
        data: {
          labels: generateDateLabels(7),
          datasets: [{
            label: 'Revenue',
            data: generateRandomData(7, 500, 2000),
            borderColor: '#f59e0b',
            backgroundColor: 'rgba(245, 158, 11, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return '$' + value.toLocaleString();
                }
              }
            }
          }
        }
      });

      // Initialize Activity Chart
      const activityCtx = document.getElementById('activityChart').getContext('2d');
      activityChart = new Chart(activityCtx, {
        type: 'doughnut',
        data: {
          labels: ['Staking', 'Trading', 'Transfers', 'Other'],
          datasets: [{
            data: [45, 25, 20, 10],
            backgroundColor: [
              '#6366f1',
              '#10b981',
              '#f59e0b',
              '#ef4444'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
            }
          }
        }
      });

      // Update analytics summary
      updateAnalyticsSummary();
    }

    // Generate date labels for charts
    function generateDateLabels(days) {
      const labels = [];
      const today = new Date();
      
      for (let i = days - 1; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
      }
      
      return labels;
    }

    // Generate random data for demo purposes
    function generateRandomData(count, min, max) {
      const data = [];
      for (let i = 0; i < count; i++) {
        data.push(Math.floor(Math.random() * (max - min + 1)) + min);
      }
      return data;
    }

    // Update analytics based on time range
    function updateAnalytics() {
      const timeRange = document.getElementById('timeRange').value;
      let days;
      
      switch(timeRange) {
        case '7d': days = 7; break;
        case '30d': days = 30; break;
        case '90d': days = 90; break;
        case '1y': days = 365; break;
        default: days = 7;
      }
      
      // Update all charts with new data
      updateChartData(userGrowthChart, days);
      updateChartData(transactionChart, days);
      updateChartData(revenueChart, days);
      
      showNotification(`Analytics updated for ${timeRange}`, 'success');
      trackActivity();
    }

    // Update chart data
    function updateChartData(chart, days) {
      chart.data.labels = generateDateLabels(days);
      
      chart.data.datasets.forEach(dataset => {
        const min = dataset.label.includes('Users') ? 10 : 100;
        const max = dataset.label.includes('Users') ? 500 : 5000;
        dataset.data = generateRandomData(days, min, max);
      });
      
      chart.update();
    }

    // Refresh analytics data
    function refreshAnalytics() {
      showLoading(true, 'Refreshing analytics...');
      
      // Simulate API call
      setTimeout(() => {
        initAnalytics();
        showLoading(false);
        showNotification('Analytics refreshed successfully', 'success');
      }, 1000);
    }

    // Update analytics summary cards
    function updateAnalyticsSummary() {
      // Simulate real data - in production, this would come from your API
      document.getElementById('growthRate').textContent = `+${(Math.random() * 20 + 5).toFixed(1)}%`;
      document.getElementById('activeUsersAnalytics').textContent = (Math.random() * 2000 + 500).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      document.getElementById('totalRevenue').textContent = `$${(Math.random() * 50000 + 10000).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
      
      const minutes = Math.floor(Math.random() * 30 + 10);
      const seconds = Math.floor(Math.random() * 60);
      document.getElementById('avgSession').textContent = `${minutes}m ${seconds}s`;
    }

    // Format date time
    function formatDateTime(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Generate sample users
    function generateSampleUsers() {
      return [
        {
          id: 1,
          name: 'John Doe',
          email: 'john@example.com',
          wallet_balance: 1250.75,
          staked_amount: 500.00,
          reward_balance: 25.12,
          is_verified: true,
          created_at: '2024-01-15T10:30:00Z'
        },
        {
          id: 2,
          name: 'Jane Smith',
          email: 'jane@example.com',
          wallet_balance: 850.50,
          staked_amount: 300.00,
          reward_balance: 15.75,
          is_verified: true,
          created_at: '2024-01-20T14:15:00Z'
        },
        {
          id: 3,
          name: 'Bob Wilson',
          email: 'bob@example.com',
          wallet_balance: 2100.00,
          staked_amount: 1000.00,
          reward_balance: 50.25,
          is_verified: false,
          created_at: '2024-02-01T09:45:00Z'
        }
      ];
    }

    // Load all transactions
    async function loadAllTransactions() {
      try {
        const response = await fetch(`${API_BASE}/admin/transactions`, {
          headers: {
            'Authorization': `Bearer ${adminToken}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          allTransactions = await response.json();
        } else {
          // Fallback - create sample data
          allTransactions = generateSampleTransactions();
        }
        console.log('üí∞ Transactions loaded:', allTransactions.length);
      } catch (error) {
        console.log('‚ö†Ô∏è Transactions API not available, using sample data...');
        allTransactions = generateSampleTransactions();
      }
    }

    // Generate sample transactions
    function generateSampleTransactions() {
      return [
        {
          id: 1,
          user_id: 1,
          user_name: 'John Doe',
          user_email: 'john@example.com',
          type: 'stake',
          amount: 500.00,
          description: 'Initial staking',
          status: 'completed',
          created_at: '2024-01-15T10:35:00Z'
        },
        {
          id: 2,
          user_id: 2,
          user_name: 'Jane Smith',
          user_email: 'jane@example.com',
          type: 'deposit',
          amount: 850.50,
          description: 'Wallet deposit',
          status: 'completed',
          created_at: '2024-01-20T14:20:00Z'
        },
        {
          id: 3,
          user_id: 1,
          user_name: 'John Doe',
          user_email: 'john@example.com',
          type: 'reward',
          amount: 25.12,
          description: 'Monthly rewards',
          status: 'completed',
          created_at: '2024-02-15T10:30:00Z'
        },
        {
          id: 4,
          user_id: 3,
          user_name: 'Bob Wilson',
          user_email: 'bob@example.com',
          type: 'withdraw',
          amount: 100.00,
          description: 'Withdrawal request',
          status: 'pending',
          created_at: '2024-02-20T15:45:00Z'
        }
      ];
    }

    // Update dashboard UI
    function updateDashboard() {
      // Update statistics cards
      document.getElementById('totalUsers').textContent = systemStats.totalUsers || 0;
      document.getElementById('totalTransactions').textContent = systemStats.totalTransactions || 0;
      document.getElementById('totalStaked').textContent = '$' + (systemStats.totalStaked || 0).toFixed(2);
      document.getElementById('activeUsers').textContent = systemStats.activeUsers || 0;
      
      // Update users table
      updateUsersTable();
      
      // Update transactions table
      updateTransactionsTable();
    }

    // Update users table
    function updateUsersTable() {
      const tbody = document.getElementById('usersTableBody');
      tbody.innerHTML = '';
      
      allUsers.forEach(user => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${user.id}</td>
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td>
            <div style="max-width: 120px; overflow: hidden; text-overflow: ellipsis; font-family: monospace; font-size: 0.8rem;">
              ${user.wallet_address || 'N/A'}
              ${user.wallet_address ? `<button onclick="copyToClipboard('${user.wallet_address}')" style="background: none; border: none; color: #10b981; cursor: pointer; padding: 0.1rem; margin-left: 0.25rem;" title="Copy"><i class="fas fa-copy"></i></button>` : ''}
            </div>
          </td>
          <td>$${parseFloat(user.wallet_balance || 0).toFixed(2)}</td>
          <td>$${parseFloat(user.staked_amount || 0).toFixed(2)}</td>
          <td>$${parseFloat(user.reward_balance || 0).toFixed(2)}</td>
          <td>
            <span class="badge ${user.is_verified ? 'badge-success' : 'badge-warning'}">
              ${user.is_verified ? 'Verified' : 'Pending'}
            </span>
          </td>
          <td>${new Date(user.created_at).toLocaleDateString()}</td>
          <td>
            <button class="btn btn-sm btn-primary" onclick="editUser(${user.id})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-info" onclick="resetPassword(${user.id})">
              <i class="fas fa-key"></i>
            </button>
            <button class="btn btn-sm btn-success" onclick="toggleVerification(${user.id})">
              <i class="fas fa-check"></i>
            </button>
            <button class="btn btn-sm btn-warning" onclick="viewWalletDetails('${user.email}')" title="View Wallet Details">
              <i class="fas fa-wallet"></i>
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Copy to clipboard function
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showNotification('Address copied to clipboard!', 'success');
      }).catch(() => {
        showNotification('Failed to copy address', 'error');
      });
    }

    // View wallet details
    function viewWalletDetails(userEmail) {
      const allUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
      const user = allUsers.find(u => u.email === userEmail);
      
      if (!user) {
        showNotification('User not found', 'error');
        return;
      }
      
      // Create modal for wallet details
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      `;
      
      modal.innerHTML = `
        <div style="background: linear-gradient(135deg, #1e293b, #334155); padding: 2rem; border-radius: 1rem; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="color: #fff; font-size: 1.5rem;">Wallet Details</h3>
            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer;">&times;</button>
          </div>
          
          <div style="background: rgba(30, 41, 59, 0.6); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem;">
            <div style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 0.5rem;">User Information</div>
            <div style="color: #f8fafc; font-weight: 600;">${user.name}</div>
            <div style="color: #64748b; font-size: 0.9rem;">${user.email}</div>
          </div>
          
          <div style="background: rgba(30, 41, 59, 0.6); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem;">
            <div style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 0.5rem;">Wallet Address</div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div style="color: #f8fafc; font-family: monospace; font-size: 0.9rem; word-break: break-all; flex: 1;">${user.walletAddress}</div>
              <button onclick="copyToClipboard('${user.walletAddress}')" style="background: none; border: none; color: #10b981; cursor: pointer; padding: 0.5rem; margin-left: 0.5rem;">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </div>
          
          <div style="background: rgba(30, 41, 59, 0.6); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem;">
            <div style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 0.5rem;">Public Key</div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div style="color: #f8fafc; font-family: monospace; font-size: 0.8rem; word-break: break-all; flex: 1;">${user.publicKey}</div>
              <button onclick="copyToClipboard('${user.publicKey}')" style="background: none; border: none; color: #10b981; cursor: pointer; padding: 0.5rem; margin-left: 0.5rem;">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </div>
          
          <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem; border-left: 4px solid #ef4444;">
            <div style="color: #ef4444; font-size: 0.9rem; font-weight: 600; margin-bottom: 0.5rem;">
              <i class="fas fa-exclamation-triangle"></i> Private Key (Sensitive Information)
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div style="color: #f8fafc; font-family: monospace; font-size: 0.8rem; word-break: break-all; flex: 1;">${user.privateKey}</div>
              <button onclick="copyToClipboard('${user.privateKey}')" style="background: none; border: none; color: #ef4444; cursor: pointer; padding: 0.5rem; margin-left: 0.5rem;">
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <div style="color: #64748b; font-size: 0.8rem; margin-top: 0.5rem;">
              Keep this private key secure. Never share it with anyone.
            </div>
          </div>
          
          <div style="background: rgba(30, 41, 59, 0.6); padding: 1rem; border-radius: 0.75rem;">
            <div style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 0.5rem;">Wallet Information</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div>
                <div style="color: #64748b; font-size: 0.8rem;">Network</div>
                <div style="color: #f8fafc;">${user.network || 'ETH'}</div>
              </div>
              <div>
                <div style="color: #64748b; font-size: 0.8rem;">Balance</div>
                <div style="color: #f8fafc;">${user.balance || '0.00000000'} ETH</div>
              </div>
              <div>
                <div style="color: #64748b; font-size: 0.8rem;">Created</div>
                <div style="color: #f8fafc;">${new Date(user.createdAt).toLocaleDateString()}</div>
              </div>
              <div>
                <div style="color: #64748b; font-size: 0.8rem;">Status</div>
                <div style="color: #10b981;">${user.status || 'Active'}</div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Close on outside click
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }

    // Update transactions table
    function updateTransactionsTable() {
      const tbody = document.getElementById('transactionsTableBody');
      tbody.innerHTML = '';
      
      allTransactions.forEach(transaction => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${transaction.id}</td>
          <td>${transaction.user_name || 'Unknown'}</td>
          <td>${transaction.user_email || 'N/A'}</td>
          <td>
            <span class="badge badge-${getTypeColor(transaction.type)}">
              ${transaction.type}
            </span>
          </td>
          <td>$${parseFloat(transaction.amount || 0).toFixed(2)}</td>
          <td>${transaction.description || 'N/A'}</td>
          <td>
            <span class="badge badge-${getStatusColor(transaction.status)}">
              ${transaction.status}
            </span>
          </td>
          <td>${new Date(transaction.created_at).toLocaleDateString()}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="updateTransactionStatus(${transaction.id})">
              <i class="fas fa-sync"></i>
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Get type color
    function getTypeColor(type) {
      const colors = {
        'stake': 'primary',
        'unstake': 'warning',
        'reward': 'success',
        'deposit': 'info',
        'withdraw': 'danger'
      };
      return colors[type] || 'secondary';
    }

    // Get status color
    function getStatusColor(status) {
      const colors = {
        'pending': 'warning',
        'completed': 'success',
        'failed': 'danger'
      };
      return colors[status] || 'secondary';
    }

    // Edit user
    function editUser(userId) {
      console.log('üîß Edit User called with ID:', userId);
      
      // Prevent auto-edit on page load
      if (!userId || userId === undefined) {
        console.log('üîß Invalid userId, preventing auto-edit');
        return;
      }
      
      const user = allUsers.find(u => u.id === userId);
      if (!user) {
        console.log('üîß User not found, preventing auto-edit');
        return;
      }
      
      console.log('üîß Editing user:', user);
      
      // Populate modal
      document.getElementById('editUserId').value = user.id;
      document.getElementById('editUserName').value = user.name;
      document.getElementById('editUserEmail').value = user.email;
      document.getElementById('editUserWallet').value = user.wallet_balance;
      document.getElementById('editUserStaked').value = user.staked_amount;
      document.getElementById('editUserRewards').value = user.reward_balance;
      
      // Show modal
      document.getElementById('editUserModal').style.display = 'block';
      console.log('üîß Edit modal opened for user:', userId);
    }

    // Reset user password
    async function resetPassword(userId) {
      const user = allUsers.find(u => u.id === userId);
      if (!user) return;
      
      if (confirm(`Reset password for ${user.name} (${user.email})?`)) {
        try {
          const response = await fetch(`${API_BASE}/admin/reset-password`, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${adminToken}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              userId: userId,
              email: user.email
            })
          });
          
          if (response.ok) {
            showNotification(`Password reset email sent to ${user.email}`, 'success');
          } else {
            // Fallback - generate new password
            const newPassword = generateRandomPassword();
            showNotification(`New password for ${user.email}: ${newPassword}`, 'info');
          }
        } catch (error) {
          const newPassword = generateRandomPassword();
          showNotification(`New password for ${user.email}: ${newPassword}`, 'info');
        }
      }
    }

    // Generate random password
    function generateRandomPassword() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let password = '';
      for (let i = 0; i < 12; i++) {
        password += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return password;
    }

    // Toggle user verification
    async function toggleVerification(userId) {
      const user = allUsers.find(u => u.id === userId);
      if (!user) return;
      
      try {
        const response = await fetch(`${API_BASE}/admin/toggle-verification`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${adminToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            userId: userId,
            is_verified: !user.is_verified
          })
        });
        
        if (response.ok) {
          user.is_verified = !user.is_verified;
          updateUsersTable();
          showNotification(`User verification updated for ${user.email}`, 'success');
        } else {
          // Fallback - update locally
          user.is_verified = !user.is_verified;
          updateUsersTable();
          showNotification(`User verification updated for ${user.email}`, 'success');
        }
      } catch (error) {
        // Fallback - update locally
        user.is_verified = !user.is_verified;
        updateUsersTable();
        showNotification(`User verification updated for ${user.email}`, 'success');
      }
    }

    // Update transaction status
    async function updateTransactionStatus(transactionId) {
      const transaction = allTransactions.find(t => t.id === transactionId);
      if (!transaction) return;
      
      const newStatus = prompt(`Enter new status for transaction ${transactionId}:`, transaction.status);
      if (!newStatus) return;
      
      try {
        const response = await fetch(`${API_BASE}/admin/update-transaction`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${adminToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            transactionId: transactionId,
            status: newStatus
          })
        });
        
        if (response.ok) {
          transaction.status = newStatus;
          updateTransactionsTable();
          showNotification(`Transaction ${transactionId} status updated to ${newStatus}`, 'success');
        } else {
          // Fallback - update locally
          transaction.status = newStatus;
          updateTransactionsTable();
          showNotification(`Transaction ${transactionId} status updated to ${newStatus}`, 'success');
        }
      } catch (error) {
        // Fallback - update locally
        transaction.status = newStatus;
        updateTransactionsTable();
        showNotification(`Transaction ${transactionId} status updated to ${newStatus}`, 'success');
      }
    }

    // Save user edits
    async function saveUserEdits() {
      console.log('üîß Save User Edits called');
      
      // Prevent auto-save on page load
      const userIdElement = document.getElementById('editUserId');
      if (!userIdElement || !userIdElement.value) {
        console.log('üîß No user ID found, preventing auto-save');
        return;
      }
      
      const userId = parseInt(userIdElement.value);
      if (!userId || isNaN(userId)) {
        console.log('üîß Invalid user ID, preventing auto-save');
        return;
      }
      
      const user = allUsers.find(u => u.id === userId);
      if (!user) {
        console.log('üîß User not found, preventing auto-save');
        return;
      }
      
      console.log('üîß Saving edits for user:', user);
      
      const updatedUser = {
        id: userId,
        name: document.getElementById('editUserName').value,
        email: document.getElementById('editUserEmail').value,
        wallet_balance: parseFloat(document.getElementById('editUserWallet').value),
        staked_amount: parseFloat(document.getElementById('editUserStaked').value),
        reward_balance: parseFloat(document.getElementById('editUserRewards').value)
      };
      
      try {
        const response = await fetch(`${API_BASE}/admin/update-user`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${adminToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(updatedUser)
        });
        
        if (response.ok) {
          Object.assign(user, updatedUser);
          updateUsersTable();
          closeEditModal();
          showNotification(`User ${updatedUser.name} updated successfully`, 'success');
        } else {
          // Fallback - update locally
          Object.assign(user, updatedUser);
          updateUsersTable();
          closeEditModal();
          showNotification(`User ${updatedUser.name} updated successfully`, 'success');
        }
      } catch (error) {
        // Fallback - update locally
        Object.assign(user, updatedUser);
        updateUsersTable();
        closeEditModal();
        showNotification(`User ${updatedUser.name} updated successfully`, 'success');
      }
    }

    // Close edit modal
    function closeEditModal() {
      document.getElementById('editUserModal').style.display = 'none';
    }

    // Show notification
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `alert alert-${type} alert-dismissible fade show`;
      notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      const container = document.getElementById('notificationContainer');
      container.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 5000);
    }

    // Export data
    function exportData(type) {
      let data, filename;
      
      switch(type) {
        case 'users':
          data = allUsers;
          filename = 'users_export.json';
          break;
        case 'transactions':
          data = allTransactions;
          filename = 'transactions_export.json';
          break;
        case 'stats':
          data = systemStats;
          filename = 'stats_export.json';
          break;
        default:
          return;
      }
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
      
      showNotification(`${filename} exported successfully`, 'success');
    }

    // Search functionality
    function searchUsers() {
      const searchTerm = document.getElementById('userSearch').value.toLowerCase();
      const filteredUsers = allUsers.filter(user => 
        user.name.toLowerCase().includes(searchTerm) ||
        user.email.toLowerCase().includes(searchTerm)
      );
      
      const tbody = document.getElementById('usersTableBody');
      tbody.innerHTML = '';
      
      filteredUsers.forEach(user => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${user.id}</td>
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td>$${parseFloat(user.wallet_balance || 0).toFixed(2)}</td>
          <td>$${parseFloat(user.staked_amount || 0).toFixed(2)}</td>
          <td>$${parseFloat(user.reward_balance || 0).toFixed(2)}</td>
          <td>
            <span class="badge ${user.is_verified ? 'badge-success' : 'badge-warning'}">
              ${user.is_verified ? 'Verified' : 'Pending'}
            </span>
          </td>
          <td>${new Date(user.created_at).toLocaleDateString()}</td>
          <td>
            <button class="btn btn-sm btn-primary" onclick="editUser(${user.id})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-info" onclick="resetPassword(${user.id})">
              <i class="fas fa-key"></i>
            </button>
            <button class="btn btn-sm btn-success" onclick="toggleVerification(${user.id})">
              <i class="fas fa-check"></i>
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Search transactions
    function searchTransactions() {
      const searchTerm = document.getElementById('transactionSearch').value.toLowerCase();
      const filteredTransactions = allTransactions.filter(transaction => 
        (transaction.user_name && transaction.user_name.toLowerCase().includes(searchTerm)) ||
        (transaction.user_email && transaction.user_email.toLowerCase().includes(searchTerm)) ||
        transaction.type.toLowerCase().includes(searchTerm) ||
        transaction.status.toLowerCase().includes(searchTerm)
      );
      
      const tbody = document.getElementById('transactionsTableBody');
      tbody.innerHTML = '';
      
      filteredTransactions.forEach(transaction => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${transaction.id}</td>
          <td>${transaction.user_name || 'Unknown'}</td>
          <td>${transaction.user_email || 'N/A'}</td>
          <td>
            <span class="badge badge-${getTypeColor(transaction.type)}">
              ${transaction.type}
            </span>
          </td>
          <td>$${parseFloat(transaction.amount || 0).toFixed(2)}</td>
          <td>${transaction.description || 'N/A'}</td>
          <td>
            <span class="badge badge-${getStatusColor(transaction.status)}">
              ${transaction.status}
            </span>
          </td>
          <td>${new Date(transaction.created_at).toLocaleDateString()}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="updateTransactionStatus(${transaction.id})">
              <i class="fas fa-sync"></i>
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Logout
    function adminLogout() {
      localStorage.removeItem('adminToken');
      localStorage.removeItem('adminUser');
      window.location.href = 'admin-login.html';
    }

    // Go to admin setup
    function goToAdminSetup() {
      window.location.href = 'admin-setup.html';
    }

    // Change admin password
    function changeAdminPassword() {
      const newPassword = prompt('Enter new password:');
      if (!newPassword || newPassword.length < 8) {
        showNotification('Password must be at least 8 characters', 'error');
        return;
      }
      
      const confirmPassword = prompt('Confirm new password:');
      if (newPassword !== confirmPassword) {
        showNotification('Passwords do not match', 'error');
        return;
      }
      
      // Update admin password in localStorage
      const adminAccounts = JSON.parse(localStorage.getItem('adminAccounts')) || [];
      const adminIndex = adminAccounts.findIndex(a => a.id === currentAdmin.id);
      
      if (adminIndex !== -1) {
        adminAccounts[adminIndex].password = newPassword;
        localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
        showNotification('Password changed successfully', 'success');
      } else {
        showNotification('Error changing password', 'error');
      }
    }

    // View admin activity logs
    function viewActivityLogs() {
      showNotification('Activity logs feature coming soon!', 'info');
    }

    // System backup
    function createSystemBackup() {
      const backupData = {
        timestamp: new Date().toISOString(),
        admin: currentAdmin,
        users: allUsers,
        transactions: allTransactions,
        stats: systemStats
      };
      
      const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `nexchain-backup-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      showNotification('System backup created successfully', 'success');
    }

    // Clear system data (for testing)
    function clearSystemData() {
      // Show secret key prompt
      const secretKey = prompt('‚ö†Ô∏è DANGER: This will delete ALL system data!\n\nEnter the secret key to proceed:');
      
      if (secretKey === null) {
        // User cancelled
        return;
      }
      
      if (secretKey !== '123') {
        showNotification('‚ùå Invalid secret key! Access denied.', 'error');
        return;
      }
      
      // Double confirmation
      if (!confirm('‚ö†Ô∏è FINAL WARNING!\n\nThis will permanently delete:\n‚Ä¢ All user accounts\n‚Ä¢ All transaction records\n‚Ä¢ All wallet data\n‚Ä¢ All admin accounts\n\nThis action CANNOT be undone!\n\nAre you absolutely sure?')) {
        return;
      }
      
      if (!confirm('üî¥ LAST CHANCE!\n\nType "DELETE" to confirm permanent data deletion:')) {
        return;
      }
      
      try {
        // Clear all localStorage data
        localStorage.removeItem('adminAccounts');
        localStorage.removeItem('adminToken');
        localStorage.removeItem('adminUser');
        localStorage.setItem('users', JSON.stringify([]));
        localStorage.setItem('wallets', JSON.stringify([]));
        localStorage.setItem('transactions', JSON.stringify([]));
        localStorage.setItem('stakes', JSON.stringify([]));
        
        showNotification('üóëÔ∏è All system data cleared successfully. Logging out...', 'warning');
        
        // Force logout and redirect
        setTimeout(() => {
          window.location.href = 'admin-login.html';
        }, 2000);
        
      } catch (error) {
        console.error('‚ùå Error clearing system data:', error);
        showNotification('‚ùå Failed to clear system data. Please try again.', 'error');
      }
    }

    // Show create new account modal
    function showCreateNewAccount() {
      document.getElementById('createAccountModal').style.display = 'block';
    }

    // Close create account modal
    function closeCreateAccountModal() {
      document.getElementById('createAccountModal').style.display = 'none';
      document.getElementById('createNewAccountForm').reset();
    }

    // Show secret key info modal
    function showSecretKeyInfo() {
      document.getElementById('secretKeyModal').style.display = 'block';
    }

    // Close secret key modal
    function closeSecretKeyModal() {
      document.getElementById('secretKeyModal').style.display = 'none';
    }

    // Copy secret key
    function copySecretKey() {
      const secretKey = '123';
      navigator.clipboard.writeText(secretKey).then(() => {
        showNotification('Secret key copied to clipboard!', 'success');
      }).catch(() => {
        showNotification('Failed to copy secret key', 'error');
      });
    }

    // Create new admin account with secret key
    function createNewAdminAccount(event) {
      event.preventDefault();
      
      const name = document.getElementById('newAdminName').value.trim();
      const email = document.getElementById('newAdminEmail').value.trim();
      const password = document.getElementById('newAdminPassword').value;
      const secretKey = document.getElementById('newAdminSecretKey').value.trim();
      const role = document.getElementById('newAdminRole').value;
      
      // Validate secret key
      if (secretKey !== '123') {
        showNotification('Invalid secret key! Please enter the correct secret key.', 'error');
        return;
      }
      
      // Validation
      if (!name || !email || !password || !role) {
        showNotification('Please fill in all fields', 'error');
        return;
      }
      
      if (password.length < 8) {
        showNotification('Password must be at least 8 characters', 'error');
        return;
      }
      
      // Get existing admin accounts
      let adminAccounts = JSON.parse(localStorage.getItem('adminAccounts')) || [];
      
      // Check if email already exists
      if (adminAccounts.find(admin => admin.email === email)) {
        showNotification('Admin with this email already exists', 'error');
        return;
      }
      
      // Create new admin account
      const newAdmin = {
        id: Date.now(),
        name: name,
        email: email,
        password: password, // In production, hash this password
        role: role,
        created_at: new Date().toISOString(),
        is_active: true,
        last_login: null,
        created_by: currentAdmin.name || 'System'
      };
      
      adminAccounts.push(newAdmin);
      localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
      
      showNotification(`Admin account "${name}" created successfully!`, 'success');
      
      // Reset form and close modal
      closeCreateAccountModal();
      
      // Show success details
      setTimeout(() => {
        showNotification(`New admin can login with: ${email} | Password: ${password}`, 'info');
      }, 1000);
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadAdminDashboard();
    });
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      min-height: 100vh;
      color: #333;
    }

    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .admin-header {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 20px 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .header-content {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .header-title h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .header-title p {
      font-size: 1.1rem;
      opacity: 0.9;
      margin: 0;
    }

    .admin-info {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .info-item {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px 15px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .info-item.logout-section {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.2));
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .logout-btn {
      background: linear-gradient(135deg, #ef4444, #dc2626) !important;
      color: white !important;
      border: none !important;
      padding: 8px 16px !important;
      border-radius: 8px !important;
      font-size: 0.85rem !important;
      font-weight: 500 !important;
      cursor: pointer !important;
      transition: all 0.3s ease !important;
      display: flex !important;
      align-items: center !important;
      gap: 6px !important;
    }

    .logout-btn:hover {
      background: linear-gradient(135deg, #dc2626, #b91c1c) !important;
      transform: translateY(-1px) !important;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3) !important;
    }

    .btn-primary {
      background: #6366f1;
      color: white;
    }

    .btn-primary:hover {
      background: #4f46e5;
      transform: translateY(-2px);
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-info {
      background: #0ea5e9;
      color: white;
    }

    .btn-info:hover {
      background: #0284c7;
    }

    .btn-warning {
      background: #f59e0b;
      color: white;
    }

    .btn-warning:hover {
      background: #d97706;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-sm {
      padding: 5px 10px;
      font-size: 0.8rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-card h3 {
      color: #666;
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .stat-card .value {
      color: #1e3c72;
      font-size: 2rem;
      font-weight: 700;
    }

    .section-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .section-header h2 {
      color: #1e3c72;
      font-size: 1.5rem;
      font-weight: 600;
    }

    .search-box {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .search-box input {
      padding: 8px 15px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: border-color 0.3s ease;
    }

    .search-box input:focus {
      outline: none;
      border-color: #6366f1;
    }

    .table-responsive {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }

    th {
      background: #f8fafc;
      color: #1e3c72;
      font-weight: 600;
      font-size: 0.9rem;
    }

    td {
      color: #333;
      font-size: 0.9rem;
    }

    tr:hover {
      background: #f8fafc;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 500;
      text-transform: uppercase;
    }

    .badge-primary {
      background: #dbeafe;
      color: #1e40af;
    }

    .badge-success {
      background: #d1fae5;
      color: #065f46;
    }

    .badge-warning {
      background: #fed7aa;
      color: #92400e;
    }

    .badge-danger {
      background: #fee2e2;
      color: #991b1b;
    }

    .badge-info {
      background: #dbeafe;
      color: #1e40af;
    }

    .badge-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    /* Status badges for verification codes */
    .status-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: inline-block;
    }

    .status-badge.pending {
      background: rgba(251, 191, 36, 0.1);
      color: #92400e;
      border: 1px solid rgba(251, 191, 36, 0.3);
    }

    .status-badge.expired {
      background: rgba(239, 68, 68, 0.1);
      color: #991b1b;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .status-badge.verified {
      background: rgba(16, 185, 129, 0.1);
      color: #065f46;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    /* Button styles for new users section */
    .btn-sm {
      padding: 6px 12px;
      font-size: 0.75rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
    }

    .btn-sm:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-sm:active {
      transform: translateY(0);
    }

    /* Advanced controls styling */
    .advanced-controls {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .filter-controls select {
      padding: 8px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      background: white;
      color: #374151;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .filter-controls select:hover {
      border-color: #6366f1;
    }

    .filter-controls select:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    /* Table footer styling */
    .table-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-top: 1px solid #e5e7eb;
      margin-top: 15px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .table-controls {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .bulk-actions {
      display: flex;
      gap: 8px;
      align-items: center;
      opacity: 0.5;
      pointer-events: none;
      transition: all 0.3s ease;
    }

    .bulk-actions.active {
      opacity: 1;
      pointer-events: auto;
    }

    .pagination-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .page-info {
      color: #6b7280;
      font-size: 0.9rem;
      padding: 0 10px;
    }

    .pagination-controls button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .user-checkbox {
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: #6366f1;
    }

    /* Status Badge Styles */
    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: inline-block;
    }

    .status-badge.pending {
      background: #fef3c7;
      color: #d97706;
      border: 1px solid #fbbf24;
    }

    .status-badge.confirmed {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #10b981;
    }

    .status-badge.failed {
      background: #fee2e2;
      color: #dc2626;
      border: 1px solid #ef4444;
    }

    .status-badge.expired {
      background: #f3f4f6;
      color: #6b7280;
      border: 1px solid #d1d5db;
    }

    .status-badge.approved {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #10b981;
    }

    .status-badge.rejected {
      background: #fee2e2;
      color: #dc2626;
      border: 1px solid #ef4444;
    }

    /* Mobile Responsive Design */
    @media (max-width: 768px) {
      /* General Mobile Optimizations */
      body {
        font-size: 14px;
        line-height: 1.4;
        overflow-x: hidden;
      }

      .admin-container {
        padding: 0.5rem;
        margin: 0;
        max-width: 100%;
      }

      /* Header Mobile */
      .admin-header {
        flex-direction: column;
        padding: 1rem;
        text-align: center;
      }

      .admin-header h1 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
      }

      .admin-header .subtitle {
        font-size: 0.9rem;
      }

      .admin-info {
        flex-direction: column;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      /* Sidebar Mobile */
      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        margin-bottom: 1rem;
        border-radius: 12px;
      }

      .sidebar-header {
        padding: 1rem;
        text-align: center;
      }

      .sidebar-header h2 {
        font-size: 1.2rem;
      }

      .nav-menu {
        padding: 0.5rem;
      }

      .nav-item {
        margin: 0.25rem 0;
      }

      .nav-link {
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
        border-radius: 8px;
        margin: 0.25rem 0;
      }

      .nav-link i {
        width: 20px;
        margin-right: 0.75rem;
      }

      /* Main Content Mobile */
      .main-content {
        padding: 1rem;
        margin-left: 0;
      }

      /* Section Cards Mobile */
      .section-card {
        margin-bottom: 1.5rem;
        border-radius: 12px;
        overflow: hidden;
      }

      .section-header {
        flex-direction: column;
        padding: 1rem;
        gap: 1rem;
        align-items: stretch;
      }

      .section-header h2 {
        font-size: 1.2rem;
        text-align: center;
        margin-bottom: 0.5rem;
      }

      .advanced-controls {
        flex-direction: column;
        gap: 0.75rem;
        width: 100%;
      }

      .filter-controls {
        flex-direction: column;
        gap: 0.5rem;
        width: 100%;
      }

      .filter-controls select {
        width: 100%;
        padding: 0.75rem;
        font-size: 0.9rem;
        border-radius: 8px;
      }

      .search-box {
        width: 100%;
        display: flex;
        gap: 0.5rem;
      }

      .search-box input {
        flex: 1;
        padding: 0.75rem;
        font-size: 0.9rem;
        border-radius: 8px;
      }

      .search-box button {
        padding: 0.75rem 1rem;
        border-radius: 8px;
      }

      /* Tables Mobile */
      .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        border-radius: 8px;
        margin: 0 -1rem;
        padding: 0 1rem;
      }

      table {
        min-width: 800px;
        font-size: 0.85rem;
      }

      table th {
        padding: 0.75rem 0.5rem;
        font-size: 0.8rem;
        white-space: nowrap;
      }

      table td {
        padding: 0.75rem 0.5rem;
        font-size: 0.8rem;
        white-space: nowrap;
      }

      /* Action buttons mobile */
      .btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.8rem;
        border-radius: 6px;
      }

      .btn-sm {
        padding: 0.4rem 0.6rem;
        font-size: 0.75rem;
      }

      /* Status badges mobile */
      .status-badge {
        font-size: 0.7rem;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        white-space: nowrap;
      }

      /* Pagination mobile */
      .table-footer {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
      }

      .pagination-controls {
        justify-content: center;
        gap: 0.5rem;
      }

      .pagination-controls button {
        padding: 0.5rem 0.75rem;
        font-size: 0.8rem;
      }

      /* Stats Grid Mobile */
      .stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .stat-card {
        padding: 1rem;
        text-align: center;
        border-radius: 12px;
      }

      .stat-card h3 {
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
      }

      .stat-card .value {
        font-size: 1.5rem;
        font-weight: 700;
      }

      /* Action Cards Mobile */
      .action-cards {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .action-card {
        padding: 1rem;
        border-radius: 12px;
        text-align: center;
      }

      .action-card .card-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }

      .action-card h3 {
        font-size: 1rem;
        margin-bottom: 0.25rem;
      }

      .action-card p {
        font-size: 0.8rem;
      }

      /* Charts Mobile */
      .chart-container {
        margin-bottom: 1rem;
        padding: 1rem;
        border-radius: 12px;
      }

      .chart-container h3 {
        font-size: 1rem;
        margin-bottom: 1rem;
        text-align: center;
      }

      /* Analytics Mobile */
      .analytics-controls {
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .analytics-controls select {
        width: 100%;
        padding: 0.75rem;
        border-radius: 8px;
      }

      /* Modal Mobile */
      .modal-content {
        width: 95%;
        margin: 5% auto;
        padding: 1.5rem;
        border-radius: 12px;
      }

      .modal-header {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
      }

      .modal-header h2 {
        font-size: 1.2rem;
      }

      .modal-body {
        padding: 1rem 0;
      }

      .modal-footer {
        flex-direction: column;
        gap: 0.5rem;
      }

      .modal-footer button {
        width: 100%;
        padding: 0.75rem;
        border-radius: 8px;
      }

      /* Loading Mobile */
      .loading-overlay {
        padding: 2rem;
        text-align: center;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        margin: 0 auto 1rem;
      }

      .loading-text {
        font-size: 1rem;
      }

      /* Notification Mobile */
      .notification {
        top: 1rem;
        right: 1rem;
        left: 1rem;
        width: auto;
        max-width: none;
        border-radius: 8px;
        font-size: 0.9rem;
      }

      /* User avatar mobile */
      .user-avatar {
        width: 28px;
        height: 28px;
        font-size: 0.7rem;
      }

      /* Wallet address mobile */
      .table-responsive code {
        font-size: 0.7rem;
        max-width: 80px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      /* Copy button mobile */
      .table-responsive button {
        padding: 0.3rem 0.5rem;
        font-size: 0.7rem;
      }

      /* Form elements mobile */
      input, select, textarea {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 0.75rem;
        border-radius: 8px;
      }

      /* Button groups mobile */
      .btn-group {
        flex-direction: column;
        gap: 0.5rem;
      }

      .btn-group button {
        width: 100%;
      }

      /* Tabs mobile */
      .tabs {
        flex-direction: column;
        border-radius: 8px;
      }

      .tab {
        border-radius: 0;
        text-align: center;
        padding: 0.75rem;
        font-size: 0.9rem;
      }

      .tab:first-child {
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
      }

      .tab:last-child {
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
      }
    }

    /* Small Mobile (320px - 480px) */
    @media (max-width: 480px) {
      .admin-container {
        padding: 0.25rem;
      }

      .section-header h2 {
        font-size: 1.1rem;
      }

      .table-responsive {
        margin: 0 -0.5rem;
        padding: 0 0.5rem;
      }

      table {
        min-width: 700px;
        font-size: 0.8rem;
      }

      table th, table td {
        padding: 0.5rem 0.25rem;
        font-size: 0.75rem;
      }

      .btn {
        padding: 0.4rem 0.6rem;
        font-size: 0.75rem;
      }

      .btn-sm {
        padding: 0.3rem 0.4rem;
        font-size: 0.7rem;
      }

      .status-badge {
        font-size: 0.65rem;
        padding: 0.2rem 0.4rem;
      }
    }

    /* Tablet Mobile (481px - 768px) */
    @media (min-width: 481px) and (max-width: 768px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .action-cards {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .filter-controls {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      .filter-controls select {
        flex: 1;
        min-width: 150px;
      }
    }

    /* Landscape Mobile */
    @media (max-width: 768px) and (orientation: landscape) {
      .admin-header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1rem;
      }
      
      .sidebar {
        width: 250px;
        position: fixed;
        height: 100vh;
        z-index: 999;
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .section-header {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      .section-header h2 {
        flex: 1;
        text-align: left;
      }
    }

    /* High DPI Mobile */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .status-badge {
        border-width: 0.5px;
      }
      
      .btn {
        border-width: 0.5px;
      }
    }

    /* Dark mode support for mobile */
    @media (prefers-color-scheme: dark) and (max-width: 768px) {
      body {
        background: #1a1a1a;
        color: #ffffff;
      }
      
      .section-card {
        background: #2d2d2d;
        border-color: #404040;
      }
      
      .sidebar {
        background: #2d2d2d;
        border-color: #404040;
      }
      
      table {
        background: #2d2d2d;
      }
      
      table th {
        background: #404040;
        color: #ffffff;
      }
      
      table tr:nth-child(even) {
        background: #363636;
      }
    }

    /* Reduce motion for accessibility */
    @media (prefers-reduced-motion: reduce) and (max-width: 768px) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Badge Success for users table */
    .badge-success {
      background: #d1fae5;
      color: #065f46;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-warning {
      background: #fef3c7;
      color: #d97706;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    /* Checkbox styling */
    input[type="checkbox"] {
      cursor: pointer;
      accent-color: #6366f1;
    }

    input[type="checkbox"]:hover {
      transform: scale(1.1);
    }

    /* Bulk selection indicator */
    .bulk-selection-indicator {
      background: #6366f1;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-left: 5px;
    }

    /* Mobile responsive for pagination */
    @media (max-width: 768px) {
      .table-controls {
        flex-direction: column;
        gap: 10px;
        width: 100%;
      }

      .bulk-actions {
        order: -1;
        width: 100%;
        justify-content: center;
      }

      .pagination-controls {
        order: 1;
      }

      .table-actions {
        order: 2;
        width: 100%;
        justify-content: center;
      }

      .bulk-actions button,
      .pagination-controls button,
      .table-actions button {
        font-size: 0.7rem;
        padding: 6px 10px;
      }
    }

    .results-info {
      color: #6b7280;
      font-size: 0.9rem;
    }

    .table-actions {
      display: flex;
      gap: 10px;
    }

    .btn.secondary {
      background: #f3f4f6;
      color: #374151;
      border: 1px solid #e5e7eb;
    }

    .btn.secondary:hover {
      background: #e5e7eb;
      border-color: #d1d5db;
    }

    /* Sortable table headers */
    th {
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s ease;
    }

    th:hover {
      background: #f1f5f9;
    }

    th i {
      margin-left: 5px;
      opacity: 0.5;
      font-size: 0.8rem;
    }

    th.sorted-asc i,
    th.sorted-desc i {
      opacity: 1;
    }

    /* Empty state styling */
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #6b7280;
    }

    .empty-state i {
      display: block;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    .empty-state p {
      margin-bottom: 15px;
      font-size: 1rem;
    }

    /* Analytics Dashboard Styling */
    .analytics-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .analytics-controls select {
      padding: 8px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      background: white;
      color: #374151;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 25px;
      margin: 25px 0;
    }

    .chart-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      border: 1px solid #e5e7eb;
      min-height: 300px;
    }

    .chart-container h3 {
      margin: 0 0 20px 0;
      color: #1f2937;
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .chart-container h3 i {
      color: #6366f1;
      font-size: 1rem;
    }

    .chart-container canvas {
      max-height: 250px;
    }

    .analytics-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 25px;
      padding-top: 25px;
      border-top: 1px solid #e5e7eb;
    }

    .summary-card {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      border: 1px solid #e5e7eb;
      transition: all 0.3s ease;
    }

    .summary-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .summary-icon {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .summary-content h4 {
      margin: 0 0 5px 0;
      color: #6b7280;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .summary-value {
      margin: 0 0 5px 0;
      color: #1f2937;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .summary-trend {
      font-size: 0.8rem;
      font-weight: 500;
      display: inline-block;
      padding: 2px 6px;
      border-radius: 4px;
    }

    .summary-trend.positive {
      color: #10b981;
      background: #d1fae5;
    }

    .summary-trend.negative {
      color: #ef4444;
      background: #fee2e2;
    }

    /* Mobile responsive for analytics */
    @media (max-width: 768px) {
      .analytics-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .chart-container {
        min-height: 250px;
        padding: 15px;
      }

      .analytics-summary {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .summary-card {
        padding: 15px;
      }

      .summary-icon {
        width: 40px;
        height: 40px;
        font-size: 1rem;
      }

      .summary-value {
        font-size: 1.2rem;
      }

      .analytics-controls {
        flex-direction: column;
        width: 100%;
      }

      .analytics-controls select {
        width: 100%;
      }
    }
    @media (max-width: 768px) {
      .advanced-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }

      .filter-controls {
        justify-content: center;
        flex-wrap: wrap;
      }

      .filter-controls select {
        flex: 1;
        min-width: 120px;
      }

      .table-footer {
        flex-direction: column;
        text-align: center;
      }

      .table-actions {
        justify-content: center;
        flex-wrap: wrap;
      }
    }

    /* Loading overlay */
    #loadingOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .loading-container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f4f6;
      border-top: 4px solid #6366f1;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-message {
      color: #374151;
      font-size: 1rem;
      font-weight: 500;
    }

    .table-loading {
      text-align: center;
      padding: 40px;
      color: #6b7280;
    }

    .table-loading .loading-spinner {
      width: 30px;
      height: 30px;
      margin-bottom: 10px;
    }

    /* Enhanced notifications */
    .notification {
      background: white;
      border-radius: 8px;
      padding: 16px;
      margin: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      animation: slideInRight 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .notification::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 4px;
      height: 100%;
    }

    .notification.success::before { background: #10b981; }
    .notification.error::before { background: #ef4444; }
    .notification.warning::before { background: #f59e0b; }
    .notification.info::before { background: #3b82f6; }

    .notification-content {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .notification-close {
      background: none;
      border: none;
      color: #6b7280;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .notification-close:hover {
      background: #f3f4f6;
      color: #374151;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-header h3 {
      color: #1e3c72;
      font-size: 1.3rem;
      font-weight: 600;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #666;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #333;
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 10px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus {
      outline: none;
      border-color: #6366f1;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }

    .alert {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid transparent;
    }

    .alert-success {
      background: #d1fae5;
      color: #065f46;
      border-color: #a7f3d0;
    }

    .alert-info {
      background: #dbeafe;
      color: #1e40af;
      border-color: #bfdbfe;
    }

    .alert-warning {
      background: #fed7aa;
      color: #92400e;
      border-color: #fdba74;
    }

    .alert-danger {
      background: #fee2e2;
      color: #991b1b;
      border-color: #fecaca;
    }

    .alert-dismissible {
      position: relative;
    }

    .btn-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .admin-container {
        padding: 15px;
      }

      .admin-header {
        padding: 20px;
        margin-bottom: 20px;
      }

      .header-title h1 {
        font-size: 1.5rem;
      }

      .header-title p {
        font-size: 0.9rem;
      }

      .admin-info {
        flex-direction: column;
        gap: 10px;
      }

      .info-item {
        padding: 8px 12px;
        font-size: 0.85rem;
      }

      .admin-actions {
        gap: 20px;
      }

      .action-section {
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 16px;
      }

      .action-section h2 {
        font-size: 1.2rem;
        margin-bottom: 20px;
        padding-bottom: 15px;
      }

      .action-section h2 i {
        font-size: 1.3rem;
      }

      .action-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .action-card {
        padding: 20px;
        flex-direction: column;
        text-align: center;
        gap: 16px;
        border-radius: 14px;
      }

      .action-card:hover {
        transform: translateY(-6px) scale(1.01);
      }

      .card-icon {
        width: 55px;
        height: 55px;
        font-size: 1.6rem;
        margin: 0 auto;
        border-radius: 14px;
      }

      .action-card:hover .card-icon {
        transform: rotate(5deg) scale(1.05);
      }

      .card-content h3 {
        font-size: 1.1rem;
        margin-bottom: 6px;
      }

      .card-content p {
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .stat-card {
        padding: 20px;
      }

      .stat-card .value {
        font-size: 1.5rem;
      }

      .section-card {
        padding: 20px;
      }

      .section-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }

      .search-box {
        width: 100%;
      }

      .search-box input {
        flex: 1;
      }

      .table-responsive {
        font-size: 0.8rem;
      }

      th, td {
        padding: 8px;
      }

      .modal-content {
        margin: 5% auto;
        padding: 20px;
        max-width: 95%;
        width: 95%;
        max-height: 90vh;
        overflow-y: auto;
      }

      /* Enhanced mobile touch interactions */
      .btn, .action-card, .floating-btn {
        min-height: 44px;
        min-width: 44px;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      .btn:active, .action-card:active, .floating-btn:active {
        transform: scale(0.95);
        transition: transform 0.1s ease;
      }

      /* Mobile table improvements */
      .table-responsive {
        font-size: 0.75rem;
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
      }

      .table-responsive table {
        min-width: 600px;
      }

      th, td {
        padding: 6px 4px;
        white-space: nowrap;
      }

      /* Mobile-friendly action buttons */
      .btn-sm {
        padding: 8px 12px;
        font-size: 0.7rem;
        min-height: 36px;
      }

      /* Mobile search improvements */
      .search-box {
        position: sticky;
        top: 0;
        background: white;
        z-index: 10;
        padding: 10px 0;
      }

      .search-box input {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 12px;
      }

      /* Mobile status badges */
      .status-badge {
        font-size: 0.65rem;
        padding: 2px 8px;
      }

      /* Mobile floating actions */
      .floating-admin-actions {
        bottom: 20px;
        right: 20px;
        gap: 10px;
      }

      .floating-btn {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
      }

      /* Mobile loading spinner */
      .loading-spinner {
        width: 40px;
        height: 40px;
        border-width: 3px;
      }

      .table-loading {
        padding: 20px;
      }

      /* Mobile notifications */
      .notification {
        font-size: 0.85rem;
        padding: 12px;
        margin: 5px;
      }

      /* Mobile stats cards */
      .stat-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .stat-card h3 {
        font-size: 0.9rem;
        margin-bottom: 5px;
      }

      /* Enhanced mobile animations */
      .action-card {
        animation: slideInUp 0.5s ease forwards;
        opacity: 0;
      }

      .action-card:nth-child(1) { animation-delay: 0.1s; }
      .action-card:nth-child(2) { animation-delay: 0.2s; }
      .action-card:nth-child(3) { animation-delay: 0.3s; }
      .action-card:nth-child(4) { animation-delay: 0.4s; }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    }

    /* Floating Buttons */
    .floating-admin-actions {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      z-index: 1000;
    }

    .floating-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      color: white;
    }

    .floating-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .floating-btn:not(.secondary) {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
    }

    .floating-btn.secondary {
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }

    /* Small Modal Styles */
    .small-modal {
      max-width: 450px !important;
    }

    /* Secret Key Info Styles */
    .secret-key-info {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .info-card {
      background: #f8fafc;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
    }

    .info-card h4 {
      color: #1e3c72;
      margin-bottom: 15px;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-card.warning {
      background: #fef3c7;
      border-color: #f59e0b;
    }

    .info-card.warning h4 {
      color: #92400e;
    }

    .secret-key-display {
      display: flex;
      align-items: center;
      gap: 15px;
      background: white;
      padding: 15px;
      border-radius: 8px;
      border: 2px solid #6366f1;
    }

    .secret-key-display code {
      font-size: 1.5rem;
      font-weight: bold;
      color: #6366f1;
      font-family: 'Courier New', monospace;
      flex: 1;
    }

    .info-card ol {
      margin-left: 20px;
      line-height: 1.6;
    }

    .info-card ol li {
      margin-bottom: 8px;
    }

    .info-card p {
      margin: 0;
      line-height: 1.5;
      color: #666;
    }

    /* Admin Action Cards */
    .admin-actions {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .action-section {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(249, 250, 251, 0.95));
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08), 
                  0 2px 10px rgba(0, 0, 0, 0.05),
                  inset 0 1px 0 rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.8);
      position: relative;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .action-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.6s ease;
    }

    .action-section:hover::before {
      left: 100%;
    }

    .action-section h2 {
      font-size: 1.4rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 20px;
      border-bottom: 3px solid transparent;
      border-image: linear-gradient(90deg, #667eea, #764ba2, #f093fb) 1;
      position: relative;
    }

    .action-section h2 i {
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 1.5rem;
    }

    .action-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .action-card {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      border: none;
      border-radius: 16px;
      padding: 24px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 18px;
      text-align: left;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06),
                  0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .action-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0.8;
    }

    .action-card.primary::before { 
      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
      box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
    }
    
    .action-card.warning::before { 
      background: linear-gradient(90deg, #fa709a, #fee140);
      box-shadow: 0 2px 10px rgba(250, 112, 154, 0.3);
    }
    
    .action-card.success::before { 
      background: linear-gradient(90deg, #30cfd0, #330867);
      box-shadow: 0 2px 10px rgba(48, 207, 208, 0.3);
    }
    
    .action-card.info::before { 
      background: linear-gradient(90deg, #4facfe, #00f2fe);
      box-shadow: 0 2px 10px rgba(79, 172, 254, 0.3);
    }
    
    .action-card.secondary::before { 
      background: linear-gradient(90deg, #a8edea, #fed6e3);
      box-shadow: 0 2px 10px rgba(168, 237, 234, 0.3);
    }
    
    .action-card.danger::before { 
      background: linear-gradient(90deg, #ff6b6b, #ee5a24);
      box-shadow: 0 2px 10px rgba(255, 107, 107, 0.3);
    }

    .action-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15),
                  0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .action-card:hover::before {
      height: 8px;
      opacity: 1;
    }

    .action-card:active {
      transform: translateY(-4px) scale(1.01);
      transition: all 0.1s ease;
    }

    .card-icon {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      flex-shrink: 0;
      position: relative;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .action-card.primary .card-icon { 
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    
    .action-card.warning .card-icon { 
      background: linear-gradient(135deg, #fa709a, #fee140);
      color: white;
      box-shadow: 0 8px 25px rgba(250, 112, 154, 0.3);
    }
    
    .action-card.success .card-icon { 
      background: linear-gradient(135deg, #30cfd0, #330867);
      color: white;
      box-shadow: 0 8px 25px rgba(48, 207, 208, 0.3);
    }
    
    .action-card.info .card-icon { 
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: white;
      box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
    }
    
    .action-card.secondary .card-icon { 
      background: linear-gradient(135deg, #a8edea, #fed6e3);
      color: #6b7280;
      box-shadow: 0 8px 25px rgba(168, 237, 234, 0.3);
    }
    
    .action-card.danger .card-icon { 
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white;
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
    }

    .action-card:hover .card-icon {
      transform: rotate(10deg) scale(1.1);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
    }

    .card-content h3 {
      font-size: 1.2rem;
      font-weight: 700;
      color: #1a202c;
      margin-bottom: 8px;
      transition: all 0.3s ease;
    }

    .action-card:hover .card-content h3 {
      color: #2d3748;
      transform: translateX(2px);
    }

    .card-content p {
      font-size: 0.95rem;
      color: #718096;
      margin: 0;
      line-height: 1.5;
      transition: all 0.3s ease;
    }
    .action-card:hover .card-content p {
      color: #4a5568;
    }

    /* User Wallets Section Styles */
    .section-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
      overflow: hidden;
    }

    .section-header {
      display: flex;
      justify-content: between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid #e5e7eb;
      background: #f9fafb;
    }

    .section-header h2 {
      margin: 0;
      color: #1f2937;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .section-header h2 i {
      margin-right: 0.5rem;
      color: #3b82f6;
    }

    .section-controls {
      display: flex;
      gap: 0.5rem;
    }

    .search-filters {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #e5e7eb;
      background: #f9fafb;
    }

    .search-box {
      position: relative;
      margin-bottom: 1rem;
    }

    .search-box i {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #6b7280;
    }

    .search-box input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 0.875rem;
    }

    .filter-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      border: 1px solid #d1d5db;
      background: white;
      border-radius: 6px;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-btn:hover {
      background: #f3f4f6;
    }

    .filter-btn.active {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }

    .table-responsive {
      overflow-x: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th {
      background: #f9fafb;
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      color: #374151;
      border-bottom: 1px solid #e5e7eb;
      cursor: pointer;
      user-select: none;
    }

    .data-table th:hover {
      background: #f3f4f6;
    }

    .data-table th i {
      margin-left: 0.5rem;
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .data-table td {
      padding: 1rem;
      border-bottom: 1px solid #f3f4f6;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #3b82f6;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
    }

    .user-name {
      font-weight: 600;
      color: #1f2937;
    }

    .user-id {
      font-size: 0.75rem;
      color: #6b7280;
    }

    .email-cell {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #374151;
    }

    .email-cell i {
      color: #9ca3af;
    }

    .wallet-address,
    .private-key {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .address-input,
    .key-input {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 0.75rem;
      font-family: monospace;
      background: #f9fafb;
    }

    .copy-btn {
      padding: 0.5rem;
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .copy-btn:hover {
      background: #e5e7eb;
    }

    .balance-amount {
      font-weight: 600;
      font-size: 0.875rem;
    }

    .balance-amount.positive {
      color: #10b981;
    }

    .balance-amount.zero {
      color: #6b7280;
    }

    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .status-badge.success {
      background: #d1fae5;
      color: #065f46;
    }

    .status-badge.warning {
      background: #fed7aa;
      color: #92400e;
    }

    .status-badge.danger {
      background: #fee2e2;
      color: #991b1b;
    }

    .status-badge.secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .btn-icon {
      padding: 0.5rem;
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      color: #6b7280;
    }

    .btn-icon:hover {
      background: #e5e7eb;
      color: #374151;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #6b7280;
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: #d1d5db;
    }

    .table-loading {
      text-align: center;
      padding: 3rem;
      color: #6b7280;
    }

    .table-loading .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .section-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }

      .filter-buttons {
        flex-wrap: wrap;
      }

      .data-table {
        font-size: 0.75rem;
      }

      .data-table th,
      .data-table td {
        padding: 0.5rem;
      }

      .user-avatar {
        width: 32px;
        height: 32px;
        font-size: 0.75rem;
      }

      .action-buttons {
        flex-direction: column;
      }
    }

    /* User Dashboard Features Styles */
    .form-grid {
      display: grid;
      gap: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-group label {
      font-weight: 600;
      color: #374151;
    }

    .form-input {
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: #3b82f6;
      color: white;
    }

    .btn-primary:hover {
      background: #2563eb;
    }

    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #e5e7eb;
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-icon {
      padding: 0.5rem;
      background: transparent;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-icon:hover {
      background: #f3f4f6;
    }

    .w-full {
      width: 100%;
    }

    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal.hidden {
      display: none;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
      color: #1f2937;
    }

    .modal-body {
      padding: 1.5rem;
    }

    .qr-code-container {
      width: 200px;
      height: 200px;
      margin: 0 auto 1rem;
      border: 2px dashed #d1d5db;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .qr-placeholder {
      text-align: center;
      color: #6b7280;
    }

    .qr-placeholder i {
      font-size: 3rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    .qr-address {
      margin-bottom: 1rem;
    }

    .qr-address label {
      display: block;
      font-weight: 600;
      color: #374151;
      margin-bottom: 0.5rem;
    }

    .address-display {
      padding: 0.75rem;
      background: #f9fafb;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-family: monospace;
      font-size: 0.75rem;
      word-break: break-all;
    }

    @media (max-width: 768px) {
      .modal-content {
        margin: 1rem;
        width: calc(100% - 2rem);
      }

      .form-actions {
        flex-direction: column;
      }

      .qr-code-container {
        width: 150px;
        height: 150px;
      }
    }
  </style>
</head>
<body onmousemove="trackActivity()" onkeypress="trackActivity()" onclick="trackActivity()">
  
  <!-- Activity Tracking Script -->
  <script>
    // Setup activity tracking when page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üîß Admin Panel Initializing...');
      
      // Fix: Hide all modals on page load
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        modal.style.display = 'none';
        console.log('üîß Modal hidden:', modal.id);
      });
      
      // Add activity tracking to all interactive elements
      const interactiveElements = document.querySelectorAll('button, input, select, a, [onclick]');
      interactiveElements.forEach(element => {
        element.addEventListener('click', trackActivity);
        element.addEventListener('touchstart', trackActivity);
      });
      
      // Add keyboard activity tracking
      document.addEventListener('keydown', trackActivity);
      
      // Add scroll tracking
      let scrollTimer;
      window.addEventListener('scroll', function() {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(trackActivity, 100);
      });
      
      // Start dashboard loading after delay to prevent auto-actions
      setTimeout(() => {
        loadAdminDashboard();
        loadUserWallets();
        console.log('üîß Dashboard loaded after initialization');
      }, 500);
    });

    // Enhanced notification system with sound alerts
    function showNotification(message, type = 'info', duration = 5000, sound = true) {
      const container = document.getElementById('notificationContainer');
      if (!container) return;
      
      // Play sound for important notifications
      if (sound && (type === 'error' || type === 'warning')) {
        playNotificationSound(type);
      }
      
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div class="notification-content">
          <i class="fas ${getNotificationIcon(type)}"></i>
          <span>${message}</span>
        </div>
        <button class="notification-close" onclick="this.parentElement.remove()">
          <i class="fas fa-times"></i>
        </button>
      `;
      
      container.appendChild(notification);
      
      // Auto-remove after duration
      setTimeout(() => {
        if (notification.parentElement) {
          notification.style.animation = 'slideOutRight 0.3s ease';
          setTimeout(() => notification.remove(), 300);
        }
      }, duration);
      
      // Track activity
      trackActivity();
      
      // Log notification for debugging
      console.log(` ${type.toUpperCase()}: ${message}`);
    }

    // Play notification sound (using Web Audio API for simple beep)
    function playNotificationSound(type) {
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        // Different frequencies for different types
        switch(type) {
          case 'error':
            oscillator.frequency.value = 300; // Low frequency
            gainNode.gain.value = 0.1;
            break;
          case 'warning':
            oscillator.frequency.value = 500; // Medium frequency
            gainNode.gain.value = 0.05;
            break;
          case 'success':
            oscillator.frequency.value = 800; // High frequency
            gainNode.gain.value = 0.03;
            break;
          default:
            oscillator.frequency.value = 600; // Default
            gainNode.gain.value = 0.02;
        }
        
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.1); // Short beep
        
      } catch (error) {
        console.log(' Sound notification not available:', error);
      }
    }

    // System alerts for important events
    function showAlert(title, message, type = 'info', actions = []) {
      const alertHtml = `
        <div class="system-alert ${type}">
          <div class="alert-header">
            <h3><i class="fas ${getNotificationIcon(type)}"></i> ${title}</h3>
          </div>
          <div class="alert-body">
            <p>${message}</p>
          </div>
          <div class="alert-actions">
            ${actions.map(action => `
              <button onclick="${action.onClick}" class="btn ${action.class || 'primary'}">
                ${action.icon ? `<i class="fas ${action.icon}"></i> ` : ''}${action.text}
              </button>
            `).join('')}
            <button onclick="this.closest('.system-alert').remove()" class="btn secondary">
              Dismiss
            </button>
          </div>
        </div>
      `;
      
      const alertContainer = document.createElement('div');
      alertContainer.innerHTML = alertHtml;
      document.body.appendChild(alertContainer.firstElementChild);
      
      // Auto-remove after 30 seconds for non-critical alerts
      if (type !== 'error') {
        setTimeout(() => {
          const alert = document.querySelector('.system-alert');
          if (alert) alert.remove();
        }, 30000);
      }
    }

    // Check for system alerts periodically
    function checkSystemAlerts() {
      // Check for expired verification codes
      const expiredCount = allNewUsers.filter(user => {
        const now = new Date();
        const expiresAt = new Date(user.expires_at);
        return now > expiresAt && user.status === 'pending';
      }).length;
      
      if (expiredCount > 0) {
        showAlert(
          'Expired Verification Codes',
          `${expiredCount} verification code(s) have expired. Consider resending or removing them.`,
          'warning',
          [
            {
              text: 'View Expired',
              icon: 'fa-eye',
              onClick: "document.getElementById('statusFilter').value = 'expired'; filterNewUsers();",
              class: 'primary'
            },
            {
              text: 'Clear Expired',
              icon: 'fa-trash',
              onClick: 'clearExpiredCodes()',
              class: 'danger'
            }
          ]
        );
      }
      
      // Check for high activity
      if (allNewUsers.length > 10) {
        showAlert(
          'High Registration Activity',
          `There are ${allNewUsers.length} pending registrations. Consider processing them soon.`,
          'info',
          [
            {
              text: 'View All',
              icon: 'fa-users',
              onClick: "clearFilters();",
              class: 'primary'
            }
          ]
        );
      }
    }

    // Clear expired codes
    function clearExpiredCodes() {
      const expiredUsers = allNewUsers.filter(user => {
        const now = new Date();
        const expiresAt = new Date(user.expires_at);
        return now > expiresAt;
      });
      
      if (expiredUsers.length === 0) {
        showNotification('No expired codes to clear', 'info');
        return;
      }
      
      if (confirm(`Clear ${expiredUsers.length} expired verification codes?`)) {
        expiredUsers.forEach(user => {
          deleteVerificationCode(user.id);
        });
        showNotification(`Cleared ${expiredUsers.length} expired codes`, 'success');
      }
    }

    // User Wallets Management Functions
    let allUserWallets = [];
    let filteredWallets = [];
    let walletSortColumn = 'name';
    let walletSortDirection = 'asc';
    let currentWalletFilter = 'all';

    // Load user wallets with balances
    async function loadUserWallets() {
      try {
        showTableLoading('userWalletsTableBody');
        
        // Use sample data for now (API endpoints not available)
        console.log('üîß Using sample data for user wallets...');
        
        allUserWallets = [
          {
            id: 1,
            name: 'John Doe',
            email: 'john@example.com',
            child_address: '0x1234567890123456789012345678901234567890',
            child_private_key: 'private_key_hidden_123456',
            balance: 1250.75,
            status: 'Active',
            created_at: '2024-01-15T10:30:00Z'
          },
          {
            id: 2,
            name: 'Jane Smith',
            email: 'jane@example.com',
            child_address: '0x2345678901234567890123456789012345678901',
            child_private_key: 'private_key_hidden_234567',
            balance: 0.00,
            status: 'Empty',
            created_at: '2024-01-16T14:20:00Z'
          },
          {
            id: 3,
            name: 'Mike Johnson',
            email: 'mike@example.com',
            child_address: '0x3456789012345678901234567890123456789012',
            child_private_key: 'private_key_hidden_345678',
            balance: 500.25,
            status: 'Active',
            created_at: '2024-01-17T09:15:00Z'
          },
          {
            id: 4,
            name: 'Sarah Wilson',
            email: 'sarah@example.com',
            child_address: '0x4567890123456789012345678901234567890123',
            child_private_key: 'private_key_hidden_456789',
            balance: 0.00,
            status: 'Empty',
            created_at: '2024-01-18T16:45:00Z'
          },
          {
            id: 5,
            name: 'Tom Brown',
            email: 'tom@example.com',
            child_address: null,
            child_private_key: null,
            balance: 0.00,
            status: 'No Wallet',
            created_at: '2024-01-19T11:30:00Z'
          }
        ];
        
        filteredWallets = [...allUserWallets];
        displayUserWallets();
        updateWalletStatistics();
        showNotification('Sample user wallets loaded (Demo Mode)', 'info');
        
      } catch (error) {
        console.error('Error loading user wallets:', error);
        showNotification('Error loading user wallets', 'error');
        displayEmptyWalletsTable();
      }
    }

    // Display user wallets in table
    function displayUserWallets() {
      const tbody = document.getElementById('userWalletsTableBody');
      
      if (filteredWallets.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" class="text-center">
              <div class="empty-state">
                <i class="fas fa-wallet"></i>
                <p>No user wallets found</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = filteredWallets.map(user => `
        <tr>
          <td>
            <div class="user-info">
              <div class="user-avatar">${user.name.charAt(0).toUpperCase()}</div>
              <div class="user-details">
                <div class="user-name">${user.name}</div>
                <div class="user-id">ID: ${user.id}</div>
              </div>
            </div>
          </td>
          <td>
            <div class="email-cell">
              <i class="fas fa-envelope"></i>
              ${user.email}
            </div>
          </td>
          <td>
            <div class="wallet-address">
              <input type="text" value="${user.child_address || 'N/A'}" readonly class="address-input">
              <button onclick="copyToClipboard('${user.child_address || 'N/A'}')" class="copy-btn" title="Copy Address">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </td>
          <td>
            <div class="private-key">
              <input type="password" value="${user.child_private_key || 'N/A'}" readonly class="key-input">
              <button onclick="copyToClipboard('${user.child_private_key || 'N/A'}')" class="copy-btn" title="Copy Key">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </td>
          <td>
            <div class="balance-cell">
              <span class="balance-amount ${user.balance > 0 ? 'positive' : 'zero'}">
                ${user.balance.toFixed(2)} USDT
              </span>
            </div>
          </td>
          <td>
            <span class="status-badge ${getStatusClass(user.status)}">
              ${user.status}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button onclick="refreshUserBalance(${user.id})" class="btn-icon" title="Refresh Balance">
                <i class="fas fa-sync"></i>
              </button>
              <button onclick="exportUserWallet(${user.id})" class="btn-icon" title="Export Wallet">
                <i class="fas fa-download"></i>
              </button>
              <button onclick="viewUserWalletDetails(${user.id})" class="btn-icon" title="View Details">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // Update wallet statistics
    function updateWalletStatistics() {
      const totalUsers = allUserWallets.length;
      const totalBalance = allUserWallets.reduce((sum, user) => sum + (user.balance || 0), 0);
      const activeWallets = allUserWallets.filter(user => user.balance > 0).length;
      const emptyWallets = allUserWallets.filter(user => user.balance === 0).length;

      document.getElementById('totalWalletUsers').textContent = totalUsers;
      document.getElementById('totalUSDTBalance').textContent = totalBalance.toFixed(2);
      document.getElementById('activeWalletCount').textContent = activeWallets;
      document.getElementById('emptyWalletCount').textContent = emptyWallets;
    }

    // Filter user wallets
    function filterUserWallets() {
      const searchTerm = document.getElementById('walletSearchInput').value.toLowerCase();
      
      filteredWallets = allUserWallets.filter(user => {
        const matchesSearch = user.name.toLowerCase().includes(searchTerm) || 
                            user.email.toLowerCase().includes(searchTerm);
        
        const matchesFilter = currentWalletFilter === 'all' ||
                             (currentWalletFilter === 'active' && user.balance > 0) ||
                             (currentWalletFilter === 'empty' && user.balance === 0);
        
        return matchesSearch && matchesFilter;
      });
      
      displayUserWallets();
    }

    // Filter wallets by status
    function filterWalletsByStatus(status) {
      currentWalletFilter = status;
      
      // Update filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      filterUserWallets();
    }

    // Sort wallets
    function sortWallets(column) {
      if (walletSortColumn === column) {
        walletSortDirection = walletSortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        walletSortColumn = column;
        walletSortDirection = 'asc';
      }
      
      filteredWallets.sort((a, b) => {
        let aVal = a[column];
        let bVal = b[column];
        
        if (column === 'balance') {
          aVal = parseFloat(aVal) || 0;
          bVal = parseFloat(bVal) || 0;
        }
        
        if (walletSortDirection === 'asc') {
          return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
        } else {
          return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
        }
      });
      
      displayUserWallets();
    }

    // Refresh user wallets
    function refreshUserWallets() {
      loadUserWallets();
      showNotification('User wallets refreshed', 'success');
    }

    // Refresh individual user balance
    async function refreshUserBalance(userId) {
      const user = allUserWallets.find(u => u.id === userId);
      if (!user) return;
      
      try {
        // Simulate balance refresh with random data
        const randomBalance = Math.random() * 2000;
        user.balance = parseFloat(randomBalance.toFixed(2));
        user.status = user.balance > 0 ? 'Active' : 'Empty';
        
        displayUserWallets();
        updateWalletStatistics();
        showNotification(`Balance refreshed for ${user.name}`, 'success');
      } catch (error) {
        showNotification(`Failed to refresh balance for ${user.name}`, 'error');
      }
    }

    // Export user wallet
    function exportUserWallet(userId) {
      const user = allUserWallets.find(u => u.id === userId);
      if (!user) return;
      
      const walletData = `
NEXCHAIN USER WALLET EXPORT
==========================
User ID: ${user.id}
Name: ${user.name}
Email: ${user.email}
Wallet Address: ${user.child_address || 'N/A'}
Private Key: ${user.child_private_key || 'N/A'}
USDT Balance: ${user.balance.toFixed(2)} USDT
Status: ${user.status}
Created At: ${user.created_at || 'N/A'}
Exported At: ${new Date().toISOString()}
==========================
      `;
      
      const blob = new Blob([walletData], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `wallet_${user.id}_${user.name.replace(/\s+/g, '_')}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      
      showNotification(`Wallet exported for ${user.name}`, 'success');
    }

    // Export all user wallets
    function exportAllUserWallets() {
      let allWalletsData = 'NEXCHAIN ALL USER WALLETS EXPORT\n';
      allWalletsData += '=' .repeat(60) + '\n';
      allWalletsData += `Generated: ${new Date().toISOString()}\n`;
      allWalletsData += `Total Users: ${allUserWallets.length}\n`;
      allWalletsData += `Total USDT Balance: ${allUserWallets.reduce((sum, user) => sum + user.balance, 0).toFixed(2)} USDT\n`;
      allWalletsData += '=' .repeat(60) + '\n\n';
      
      allUserWallets.forEach(user => {
        allWalletsData += `
USER: ${user.name} (ID: ${user.id})
Email: ${user.email}
Wallet Address: ${user.child_address || 'N/A'}
Private Key: ${user.child_private_key || 'N/A'}
USDT Balance: ${user.balance.toFixed(2)} USDT
Status: ${user.status}
Created At: ${user.created_at || 'N/A'}
${'='.repeat(60)}\n\n`;
      });
      
      const blob = new Blob([allWalletsData], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `all_user_wallets_${new Date().toISOString().split('T')[0]}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      
      showNotification('All user wallets exported successfully', 'success');
    }

    // View user wallet details
    function viewUserWalletDetails(userId) {
      const user = allUserWallets.find(u => u.id === userId);
      if (!user) return;
      
      // You can implement a modal or expandable details view here
      alert(`User Details:\n\nName: ${user.name}\nEmail: ${user.email}\nBalance: ${user.balance.toFixed(2)} USDT\nStatus: ${user.status}\nAddress: ${user.child_address || 'N/A'}`);
    }

    // Helper functions
    function getStatusClass(status) {
      switch(status) {
        case 'Active': return 'success';
        case 'Empty': return 'warning';
        case 'Error': return 'danger';
        default: return 'secondary';
      }
    }

    function copyToClipboard(text) {
      if (text === 'N/A') return;
      
      navigator.clipboard.writeText(text).then(() => {
        showNotification('Copied to clipboard', 'success');
      }).catch(() => {
        showNotification('Failed to copy', 'error');
      });
    }

    function displayEmptyWalletsTable() {
      const tbody = document.getElementById('userWalletsTableBody');
      tbody.innerHTML = `
        <tr>
          <td colspan="7" class="text-center">
            <div class="empty-state">
              <i class="fas fa-exclamation-triangle"></i>
              <p>Failed to load user wallets</p>
              <button onclick="loadUserWallets()" class="btn btn-primary">Retry</button>
            </div>
          </td>
        </tr>
      `;
    }

    // User Dashboard Features Functions
    function showDepositQR() {
      // Use sample address for demo
      const address = '0x1234567890123456789012345678901234567890';
      
      // Generate QR code (simplified - in production use proper QR library)
      const qrDiv = document.getElementById('qrCode');
      qrDiv.innerHTML = `
        <div class="qr-placeholder">
          <i class="fas fa-qrcode"></i>
          <p>QR Code for ${address.substring(0, 10)}...</p>
        </div>
      `;
      
      document.getElementById('qrAddress').textContent = address;
      document.getElementById('qrModal').classList.remove('hidden');
    }

    function hideQRModal() {
      document.getElementById('qrModal').classList.add('hidden');
    }

    function copyDepositAddress() {
      const address = '0x1234567890123456789012345678901234567890';
      navigator.clipboard.writeText(address).then(() => {
        showNotification('Address copied to clipboard!', 'success');
      });
    }

    function showWithdrawForm() {
      document.getElementById('withdrawalForm').classList.remove('hidden');
    }

    function hideWithdrawForm() {
      document.getElementById('withdrawalForm').classList.add('hidden');
    }

    function handleWithdrawal(event) {
      event.preventDefault();
      const address = document.getElementById('withdrawAddress').value;
      const amount = document.getElementById('withdrawAmount').value;
      
      // Simple validation
      if (!address || !amount) {
        showNotification('Please fill all fields', 'error');
        return;
      }
      
      // In production, this would call your API
      showNotification(`Withdrawal of ${amount} USDT to ${address} initiated!`, 'success');
      hideWithdrawForm();
      event.target.reset();
    }

    function exportTransactionHistory() {
      // Sample transaction data
      const transactionData = `NEXCHAIN TRANSACTION HISTORY EXPORT
=====================================
Generated: ${new Date().toISOString()}
Total Transactions: 3

Transaction 1:
- Date: 2024-01-15T10:30:00Z
- Type: Deposit
- Amount: 500.00 USDT
- Status: Completed
- From: 0xabc123...

Transaction 2:
- Date: 2024-01-16T14:20:00Z
- Type: Withdrawal
- Amount: 250.00 USDT
- Status: Completed
- To: 0xdef456...

Transaction 3:
- Date: 2024-01-17T09:15:00Z
- Type: Deposit
- Amount: 1000.00 USDT
- Status: Pending
- From: 0xghi789...
=====================================
      `;
      
      const blob = new Blob([transactionData], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `transaction_history_${new Date().toISOString().split('T')[0]}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      
      showNotification('Transaction history exported successfully', 'success');
    }

    function showUserStatistics() {
      // Sample statistics
      const stats = {
        totalUsers: allUserWallets.length,
        activeUsers: allUserWallets.filter(u => u.balance > 0).length,
        totalBalance: allUserWallets.reduce((sum, u) => sum + u.balance, 0),
        todayTransactions: 12,
        pendingWithdrawals: 3
      };
      
      alert(`User Statistics:
      
Total Users: ${stats.totalUsers}
Active Users: ${stats.activeUsers}
Total Balance: ${stats.totalBalance.toFixed(2)} USDT
Today's Transactions: ${stats.todayTransactions}
Pending Withdrawals: ${stats.pendingWithdrawals}`);
    }

    function refreshDashboardFeatures() {
      showNotification('Dashboard features refreshed', 'success');
    }

    // Admin Registration Functions
    async function registerNewAdmin(name, email, password) {
      try {
        console.log('üîß Registering new admin:', { name, email });
        
        // Check if API endpoint exists, fallback to demo mode
        const response = await fetch(`${API_BASE}/admin/register`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${adminToken}`
          },
          body: JSON.stringify({
            name: name,
            email: email,
            password: password,
            role: 'admin'
          })
        });

        // If API doesn't work, use demo mode
        if (!response.ok) {
          console.log('üîß API not available, using demo mode...');
          
          // Store in localStorage for demo
          const admins = JSON.parse(localStorage.getItem('registeredAdmins') || '[]');
          const newAdmin = {
            id: Date.now(),
            name: name,
            email: email,
            role: 'admin',
            created_at: new Date().toISOString(),
            status: 'active'
          };
          
          // Check if email already exists
          if (admins.find(a => a.email === email)) {
            showNotification('Admin with this email already exists!', 'error');
            return false;
          }
          
          admins.push(newAdmin);
          localStorage.setItem('registeredAdmins', JSON.stringify(admins));
          
          showNotification('New admin registered successfully! (Demo Mode)', 'success');
          return true;
        }

        const data = await response.json();

        if (data.success) {
          showNotification('New admin registered successfully!', 'success');
          return true;
        } else {
          showNotification(`Failed to register admin: ${data.message}`, 'error');
          return false;
        }
      } catch (error) {
        console.log('üîß Network error, using demo mode...');
        
        // Fallback to demo mode
        const admins = JSON.parse(localStorage.getItem('registeredAdmins') || '[]');
        const newAdmin = {
          id: Date.now(),
          name: name,
          email: email,
          role: 'admin',
          created_at: new Date().toISOString(),
          status: 'active'
        };
        
        if (admins.find(a => a.email === email)) {
          showNotification('Admin with this email already exists!', 'error');
          return false;
        }
        
        admins.push(newAdmin);
        localStorage.setItem('registeredAdmins', JSON.stringify(admins));
        
        showNotification('New admin registered successfully! (Demo Mode)', 'success');
        return true;
      }
    }

    function showAdminRegistrationForm() {
      const form = `
        <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" id="adminRegistrationModal">
          <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">Register New Admin</h3>
            <form onsubmit="handleAdminRegistration(event)">
              <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Name</label>
                <input type="text" id="adminName" required class="w-full px-3 py-2 border rounded-lg">
              </div>
              <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Email</label>
                <input type="email" id="adminEmail" required class="w-full px-3 py-2 border rounded-lg">
              </div>
              <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Password</label>
                <input type="password" id="adminPassword" required class="w-full px-3 py-2 border rounded-lg">
              </div>
              <div class="flex gap-3">
                <button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg">Register</button>
                <button type="button" onclick="closeAdminRegistrationModal()" class="flex-1 bg-gray-300 py-2 rounded-lg">Cancel</button>
              </div>
            </form>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', form);
    }

    function handleAdminRegistration(event) {
      event.preventDefault();
      const name = document.getElementById('adminName').value;
      const email = document.getElementById('adminEmail').value;
      const password = document.getElementById('adminPassword').value;
      
      registerNewAdmin(name, email, password).then(success => {
        if (success) {
          closeAdminRegistrationModal();
        }
      });
    }

    function closeAdminRegistrationModal() {
      const modal = document.getElementById('adminRegistrationModal');
      if (modal) {
        modal.remove();
      }
    }

    // Add slide out animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
      
      .system-alert {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 400px;
        max-width: 90vw;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        z-index: 10000;
        animation: slideInRight 0.3s ease;
        border-left: 4px solid #3b82f6;
      }
      
      .system-alert.error {
        border-left-color: #ef4444;
      }
      
      .system-alert.warning {
        border-left-color: #f59e0b;
      }
      
      .system-alert.success {
        border-left-color: #10b981;
      }
      
      .alert-header {
        padding: 20px 20px 10px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .alert-header h3 {
        margin: 0;
        color: #1f2937;
        font-size: 1.1rem;
      }
      
      .alert-body {
        padding: 15px 20px;
      }
      
      .alert-body p {
        margin: 0;
        color: #6b7280;
        line-height: 1.5;
      }
      
      .alert-actions {
        padding: 15px 20px 20px;
        display: flex;
        gap: 10px;
        justify-content: flex-end;
      }
      
      @media (max-width: 768px) {
        .system-alert {
          width: calc(100vw - 40px);
          right: 20px;
          left: 20px;
        }
        
        .alert-actions {
          flex-direction: column;
        }
      }
    `;
    document.head.appendChild(style);
  </script>
  <div class="admin-container">
    <!-- Admin Header -->
    <div class="admin-header">
      <div class="header-content">
        <div class="header-title">
          <h1><i class="fas fa-shield-alt"></i> NexChain Admin</h1>
          <p>System Management Dashboard</p>
        </div>
        <div class="admin-info">
          <div class="info-item">
            <i class="fas fa-user"></i>
            <span id="currentAdminName">Admin</span>
          </div>
          <div class="info-item">
            <i class="fas fa-shield-alt"></i>
            <span id="currentAdminRole">Admin</span>
          </div>
          <div class="info-item">
            <i class="fas fa-envelope"></i>
            <span id="currentAdminEmail">admin@nexchain.com</span>
          </div>
          <div class="info-item logout-section">
            <button class="btn btn-danger logout-btn" onclick="adminLogout()">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- User Dashboard Features Section -->
    <div class="section-card">
      <div class="section-header">
        <h2><i class="fas fa-tachometer-alt"></i> User Dashboard Features</h2>
        <div class="section-controls">
          <button class="btn btn-success" onclick="showAdminRegistrationForm()">
            <i class="fas fa-user-plus"></i> Add Admin
          </button>
          <button class="btn btn-primary" onclick="refreshDashboardFeatures()">
            <i class="fas fa-sync"></i> Refresh
          </button>
        </div>
      </div>

      <!-- Quick Actions Section -->
      <div class="action-grid">
        <button class="action-card success" onclick="showDepositQR()">
          <div class="card-icon">
            <i class="fas fa-qrcode"></i>
          </div>
          <div class="card-content">
            <h3>Deposit QR Code</h3>
            <p>Generate QR for mobile deposits</p>
          </div>
        </button>
        
        <button class="action-card info" onclick="showWithdrawForm()">
          <div class="card-icon">
            <i class="fas fa-paper-plane"></i>
          </div>
          <div class="card-content">
            <h3>Withdraw USDT</h3>
            <p>Send funds to external wallet</p>
          </div>
        </button>
        
        <button class="action-card warning" onclick="exportTransactionHistory()">
          <div class="card-icon">
            <i class="fas fa-download"></i>
          </div>
          <div class="card-content">
            <h3>Export History</h3>
            <p>Download transaction records</p>
          </div>
        </button>
        
        <button class="action-card secondary" onclick="showUserStatistics()">
          <div class="card-icon">
            <i class="fas fa-chart-bar"></i>
          </div>
          <div class="card-content">
            <h3>User Statistics</h3>
            <p>View user activity metrics</p>
          </div>
        </button>
      </div>
    </div>

    <!-- Withdrawal Form (Hidden by default) -->
    <div id="withdrawalForm" class="section-card hidden">
      <div class="section-header">
        <h2><i class="fas fa-paper-plane"></i> Withdraw USDT</h2>
        <button class="btn btn-secondary" onclick="hideWithdrawForm()">
          <i class="fas fa-times"></i> Cancel
        </button>
      </div>
      
      <form onsubmit="handleWithdrawal(event)" class="form-grid">
        <div class="form-group">
          <label for="withdrawAddress">üìç Recipient Address</label>
          <input type="text" id="withdrawAddress" required class="form-input" placeholder="0x...">
        </div>
        <div class="form-group">
          <label for="withdrawAmount">üí∞ Amount (USDT)</label>
          <input type="number" id="withdrawAmount" required step="0.01" min="1" class="form-input" placeholder="0.00">
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-paper-plane"></i> Withdraw
          </button>
          <button type="button" onclick="hideWithdrawForm()" class="btn btn-secondary">
            Cancel
          </button>
        </div>
      </form>
    </div>

    <!-- QR Code Modal (Hidden by default) -->
    <div id="qrModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-qrcode"></i> Deposit QR Code</h3>
          <button onclick="hideQRModal()" class="btn btn-icon">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div id="qrCode" class="qr-code-container">
            <div class="qr-placeholder">
              <i class="fas fa-qrcode"></i>
              <p>QR Code will appear here</p>
            </div>
          </div>
          <div class="qr-address">
            <label>Your Deposit Address:</label>
            <div id="qrAddress" class="address-display"></div>
          </div>
          <button onclick="copyDepositAddress()" class="btn btn-success w-full">
            <i class="fas fa-copy"></i> Copy Address
          </button>
        </div>
      </div>
    </div>

    <!-- User Wallets Section -->
    <div class="section-card">
      <div class="section-header">
        <h2><i class="fas fa-wallet"></i> User Wallets & Balances</h2>
        <div class="section-controls">
          <button class="btn btn-primary" onclick="refreshUserWallets()">
            <i class="fas fa-sync"></i> Refresh
          </button>
          <button class="btn btn-success" onclick="exportAllUserWallets()">
            <i class="fas fa-download"></i> Export All
          </button>
        </div>
      </div>
      
      <!-- Search and Filter -->
      <div class="search-filters">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="walletSearchInput" placeholder="Search users by email or name..." onkeyup="filterUserWallets()">
        </div>
        <div class="filter-buttons">
          <button class="filter-btn active" onclick="filterWalletsByStatus('all')">All Users</button>
          <button class="filter-btn" onclick="filterWalletsByStatus('active')">Active Wallets</button>
          <button class="filter-btn" onclick="filterWalletsByStatus('empty')">Empty Wallets</button>
        </div>
      </div>

      <!-- User Wallets Table -->
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th onclick="sortWallets('name')">User <i class="fas fa-sort"></i></th>
              <th onclick="sortWallets('email')">Email <i class="fas fa-sort"></i></th>
              <th onclick="sortWallets('wallet_address')">Wallet Address <i class="fas fa-sort"></i></th>
              <th onclick="sortWallets('private_key')">Private Key <i class="fas fa-sort"></i></th>
              <th onclick="sortWallets('balance')">USDT Balance <i class="fas fa-sort"></i></th>
              <th onclick="sortWallets('status')">Status <i class="fas fa-sort"></i></th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="userWalletsTableBody">
            <tr>
              <td colspan="7" class="text-center">
                <div class="table-loading">
                  <div class="loading-spinner"></div>
                  <p>Loading user wallets...</p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Wallet Statistics -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="totalWalletUsers">0</div>
            <div class="stat-label">Total Users</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="totalUSDTBalance">0.00</div>
            <div class="stat-label">Total USDT Balance</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-wallet"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="activeWalletCount">0</div>
            <div class="stat-label">Active Wallets</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-coins"></i>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="emptyWalletCount">0</div>
            <div class="stat-label">Empty Wallets</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Action Cards -->
    <div class="admin-actions">
      <div class="action-section">
        <h2><i class="fas fa-cogs"></i> Admin Management</h2>
        <div class="action-grid">
          <button class="action-card primary" onclick="goToAdminSetup()">
            <div class="card-icon">
              <i class="fas fa-user-cog"></i>
            </div>
            <div class="card-content">
              <h3>Admin Setup</h3>
              <p>Manage admin accounts</p>
            </div>
          </button>
          
          <button class="action-card warning" onclick="changeAdminPassword()">
            <div class="card-icon">
              <i class="fas fa-key"></i>
            </div>
            <div class="card-content">
              <h3>Change Password</h3>
              <p>Update admin password</p>
            </div>
          </button>
        </div>
      </div>

      <div class="action-section">
        <h2><i class="fas fa-download"></i> Data Export</h2>
        <div class="action-grid">
          <button class="action-card success" onclick="createSystemBackup()">
            <div class="card-icon">
              <i class="fas fa-server"></i>
            </div>
            <div class="card-content">
              <h3>System Backup</h3>
              <p>Download complete backup</p>
            </div>
          </button>
          
          <button class="action-card info" onclick="exportData('users')">
            <div class="card-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="card-content">
              <h3>Export Users</h3>
              <p>Download user data</p>
            </div>
          </button>
          
          <button class="action-card info" onclick="exportData('transactions')">
            <div class="card-icon">
              <i class="fas fa-exchange-alt"></i>
            </div>
            <div class="card-content">
              <h3>Export Transactions</h3>
              <p>Download transaction data</p>
            </div>
          </button>
          
          <button class="action-card info" onclick="exportData('stats')">
            <div class="card-icon">
              <i class="fas fa-chart-bar"></i>
            </div>
            <div class="card-content">
              <h3>Export Stats</h3>
              <p>Download system statistics</p>
            </div>
          </button>
        </div>
      </div>

      <div class="action-section">
        <h2><i class="fas fa-tools"></i> System Tools</h2>
        <div class="action-grid">
          <button class="action-card secondary" onclick="viewActivityLogs()">
            <div class="card-icon">
              <i class="fas fa-list"></i>
            </div>
            <div class="card-content">
              <h3>Activity Logs</h3>
              <p>View system activity</p>
            </div>
          </button>
          
          <button class="action-card danger" onclick="clearSystemData()">
            <div class="card-icon">
              <i class="fas fa-trash"></i>
            </div>
            <div class="card-content">
              <h3>Clear Data</h3>
              <p>Reset system data</p>
            </div>
          </button>
          
          <button class="action-card danger" onclick="adminLogout()">
            <div class="card-icon">
              <i class="fas fa-sign-out-alt"></i>
            </div>
            <div class="card-content">
              <h3>Logout</h3>
              <p>Exit admin panel</p>
            </div>
          </button>
        </div>
      </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Total Users</h3>
        <div class="value" id="totalUsers">0</div>
      </div>
      <div class="stat-card">
        <h3>Total Transactions</h3>
        <div class="value" id="totalTransactions">0</div>
      </div>
      <div class="stat-card">
        <h3>Total Staked</h3>
        <div class="value" id="totalStaked">$0</div>
      </div>
      <div class="stat-card">
        <h3>Active Users</h3>
        <div class="value" id="activeUsers">0</div>
      </div>
    </div>

    <!-- Analytics Dashboard -->
    <div class="section-card">
      <div class="section-header">
        <h2><i class="fas fa-chart-line"></i> Analytics Dashboard</h2>
        <div class="analytics-controls">
          <select id="timeRange" onchange="updateAnalytics()">
            <option value="7d">Last 7 Days</option>
            <option value="30d">Last 30 Days</option>
            <option value="90d">Last 90 Days</option>
            <option value="1y">Last Year</option>
          </select>
          <button class="btn btn-sm" onclick="refreshAnalytics()">
            <i class="fas fa-sync"></i> Refresh
          </button>
        </div>
      </div>
      
      <div class="analytics-grid">
        <!-- User Growth Chart -->
        <div class="chart-container">
          <h3><i class="fas fa-users"></i> User Growth</h3>
          <canvas id="userGrowthChart"></canvas>
        </div>
        
        <!-- Transaction Volume Chart -->
        <div class="chart-container">
          <h3><i class="fas fa-exchange-alt"></i> Transaction Volume</h3>
          <canvas id="transactionChart"></canvas>
        </div>
        
        <!-- Revenue Chart -->
        <div class="chart-container">
          <h3><i class="fas fa-dollar-sign"></i> Revenue Trends</h3>
          <canvas id="revenueChart"></canvas>
        </div>
        
        <!-- Activity Heatmap -->
        <div class="chart-container">
          <h3><i class="fas fa-fire"></i> Activity Heatmap</h3>
          <canvas id="activityChart"></canvas>
        </div>
      </div>
      
      <!-- Analytics Summary -->
      <div class="analytics-summary">
        <div class="summary-card">
          <div class="summary-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="summary-content">
            <h4>Growth Rate</h4>
            <p class="summary-value" id="growthRate">+12.5%</p>
            <span class="summary-trend positive">‚Üë from last month</span>
          </div>
        </div>
        
        <div class="summary-card">
          <div class="summary-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="summary-content">
            <h4>Active Users</h4>
            <p class="summary-value" id="activeUsersAnalytics">1,234</p>
            <span class="summary-trend positive">‚Üë 8.3% increase</span>
          </div>
        </div>
        
        <div class="summary-card">
          <div class="summary-icon">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="summary-content">
            <h4>Total Revenue</h4>
            <p class="summary-value" id="totalRevenue">$45,678</p>
            <span class="summary-trend positive">‚Üë 15.2% increase</span>
          </div>
        </div>
        
        <div class="summary-card">
          <div class="summary-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="summary-content">
            <h4>Avg. Session</h4>
            <p class="summary-value" id="avgSession">24m 32s</p>
            <span class="summary-trend negative">‚Üì 3.1% decrease</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Section -->
    <div class="section-card">
      <div class="section-header">
        <h2><i class="fas fa-users"></i> All Users</h2>
        <div class="search-box">
          <input type="text" id="userSearch" placeholder="Search users..." onkeyup="searchUsers()">
          <button class="btn btn-primary" onclick="searchUsers()">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Wallet Address</th>
              <th>Wallet Balance</th>
              <th>Staked Amount</th>
              <th>Reward Balance</th>
              <th>Verification</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="usersTableBody">
            <!-- Users will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- New Users with Verification Codes Section -->
    <div class="section-card">
      <div class="section-header">
        <h2><i class="fas fa-user-plus"></i> New Users - Verification Codes</h2>
        <div class="advanced-controls">
          <div class="filter-controls">
            <select id="statusFilter" onchange="filterNewUsers()">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="expired">Expired</option>
            </select>
            <select id="timeFilter" onchange="filterNewUsers()">
              <option value="">All Time</option>
              <option value="1h">Last Hour</option>
              <option value="24h">Last 24 Hours</option>
              <option value="7d">Last 7 Days</option>
            </select>
          </div>
          <div class="search-box">
            <input type="text" id="newUserSearch" placeholder="Search new users..." onkeyup="filterNewUsers()">
            <button class="btn btn-primary" onclick="filterNewUsers()">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th>
                <input type="checkbox" onchange="selectAllNewUsers()" title="Select All">
              </th>
              <th onclick="sortTable('newUsers', 'id')">
                ID <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortTable('newUsers', 'name')">
                Name <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortTable('newUsers', 'email')">
                Email <i class="fas fa-sort"></i>
              </th>
              <th>Verification Code</th>
              <th onclick="sortTable('newUsers', 'status')">
                Status <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortTable('newUsers', 'expires_at')">
                Expires In <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortTable('newUsers', 'created_at')">
                Registration Time <i class="fas fa-sort"></i>
              </th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="newUsersTableBody">
            <!-- New users with verification codes will be loaded here -->
          </tbody>
        </table>
      </div>
      <div class="table-footer">
        <div class="results-info">
          <span id="newUsersResultsCount">0 results</span>
        </div>
        <div class="table-controls">
          <div class="bulk-actions">
            <button onclick="selectAllNewUsers()" class="btn btn-sm secondary">
              <i class="fas fa-check-square"></i> Select All
            </button>
            <button onclick="bulkResendCodes()" class="btn btn-sm" style="background: #3b82f6; color: white;">
              <i class="fas fa-redo"></i> Bulk Resend
            </button>
            <button onclick="bulkDeleteCodes()" class="btn btn-sm" style="background: #ef4444; color: white;">
              <i class="fas fa-trash"></i> Bulk Delete
            </button>
          </div>
          <div class="pagination-controls">
            <button onclick="previousPage()" class="btn btn-sm secondary" id="prevBtn">
              <i class="fas fa-chevron-left"></i> Previous
            </button>
            <span class="page-info">
              Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
            </span>
            <button onclick="nextPage()" class="btn btn-sm secondary" id="nextBtn">
              Next <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          <div class="table-actions">
            <button onclick="exportFilteredNewUsers()" class="btn btn-sm">
              <i class="fas fa-download"></i> Export Filtered
            </button>
            <button onclick="clearFilters()" class="btn btn-sm secondary">
              <i class="fas fa-times"></i> Clear Filters
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- New User Deposits Section -->
    <div class="section-card">
      <div class="section-header">
        <h2><i class="fas fa-coins"></i> New User Deposits</h2>
        <div class="advanced-controls">
          <div class="filter-controls">
            <select id="depositStatusFilter" onchange="filterDeposits()">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="confirmed">Confirmed</option>
              <option value="failed">Failed</option>
            </select>
            <select id="depositTimeFilter" onchange="filterDeposits()">
              <option value="">All Time</option>
              <option value="1h">Last Hour</option>
              <option value="24h">Last 24 Hours</option>
              <option value="7d">Last 7 Days</option>
              <option value="30d">Last 30 Days</option>
            </select>
          </div>
          <div class="search-box">
            <input type="text" id="depositSearch" placeholder="Search deposits..." onkeyup="filterDeposits()">
            <button class="btn btn-primary" onclick="filterDeposits()">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th onclick="sortDeposits('id')">
                ID <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortDeposits('user_name')">
                User Name <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortDeposits('user_email')">
                Email <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortDeposits('amount')">
                Amount <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortDeposits('wallet_balance')">
                Wallet Balance <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortDeposits('reward_bonus')">
                Reward Bonus <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortDeposits('referral')">
                Referral <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortDeposits('status')">
                Status <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortDeposits('created_at')">
                Date <i class="fas fa-sort"></i>
              </th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="depositsTableBody">
            <!-- Deposits will be loaded here -->
          </tbody>
        </table>
      </div>
      <div class="table-footer">
        <div class="table-info">
          <span id="depositsCount">0 deposits found</span>
        </div>
        <div class="pagination-controls">
          <button onclick="previousDepositPage()" class="btn btn-sm secondary" id="depositPrevBtn">
            <i class="fas fa-chevron-left"></i> Previous
          </button>
          <span class="page-info">
            Page <span id="depositCurrentPage">1</span> of <span id="depositTotalPages">1</span>
          </span>
          <button onclick="nextDepositPage()" class="btn btn-sm secondary" id="depositNextBtn">
            Next <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Withdrawal Requests Section -->
    <div class="section-card">
      <div class="section-header">
        <h2><i class="fas fa-money-bill-wave"></i> Withdrawal Requests</h2>
        <div class="advanced-controls">
          <div class="filter-controls">
            <select id="withdrawalStatusFilter" onchange="filterWithdrawalRequests()">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="approved">Approved</option>
              <option value="rejected">Rejected</option>
            </select>
            <select id="withdrawalTimeFilter" onchange="filterWithdrawalRequests()">
              <option value="">All Time</option>
              <option value="1h">Last Hour</option>
              <option value="24h">Last 24 Hours</option>
              <option value="7d">Last 7 Days</option>
              <option value="30d">Last 30 Days</option>
            </select>
          </div>
          <div class="search-box">
            <input type="text" id="withdrawalSearch" placeholder="Search withdrawal requests..." onkeyup="filterWithdrawalRequests()">
            <button class="btn btn-primary" onclick="filterWithdrawalRequests()">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th onclick="sortWithdrawalRequests('id')">
                ID <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortWithdrawalRequests('user_name')">
                User Name <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortWithdrawalRequests('user_email')">
                Email <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortWithdrawalRequests('withdrawal_amount')">
                Withdrawal Amount <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortWithdrawalRequests('wallet_balance')">
                Wallet Balance <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortWithdrawalRequests('wallet_address')">
                Wallet Address <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortWithdrawalRequests('status')">
                Status <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortWithdrawalRequests('created_at')">
                Date & Time <i class="fas fa-sort"></i>
              </th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="withdrawalRequestsTableBody">
            <!-- Withdrawal requests will be loaded here -->
          </tbody>
        </table>
      </div>
      <div class="table-footer">
        <div class="table-info">
          <span id="withdrawalRequestsCount">0 withdrawal requests found</span>
        </div>
        <div class="pagination-controls">
          <button onclick="previousWithdrawalPage()" class="btn btn-sm secondary" id="withdrawalPrevBtn">
            <i class="fas fa-chevron-left"></i> Previous
          </button>
          <span class="page-info">
            Page <span id="withdrawalCurrentPage">1</span> of <span id="withdrawalTotalPages">1</span>
          </span>
          <button onclick="nextWithdrawalPage()" class="btn btn-sm secondary" id="withdrawalNextBtn">
            Next <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Transactions Section -->
    <div class="section-card">
      <div class="section-header">
        <h2><i class="fas fa-exchange-alt"></i> All Transactions</h2>
        <div class="search-box">
          <input type="text" id="transactionSearch" placeholder="Search transactions..." onkeyup="searchTransactions()">
          <button class="btn btn-primary" onclick="searchTransactions()">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>User Name</th>
              <th>User Email</th>
              <th>Type</th>
              <th>Amount</th>
              <th>Description</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="transactionsTableBody">
            <!-- Transactions will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Floating Admin Actions -->
  <div class="floating-admin-actions">
    <button class="floating-btn" onclick="showCreateNewAccount()" title="Create New Admin Account">
      <i class="fas fa-user-plus"></i>
    </button>
    <button class="floating-btn secondary" onclick="showSecretKeyInfo()" title="Secret Key Info">
      <i class="fas fa-key"></i>
    </button>
  </div>

  <!-- Create New Account Modal -->
  <div id="createAccountModal" class="modal">
    <div class="modal-content small-modal">
      <div class="modal-header">
        <h3><i class="fas fa-user-plus"></i> Create New Admin Account</h3>
        <button class="close-btn" onclick="closeCreateAccountModal()">&times;</button>
      </div>
      <form id="createNewAccountForm" onsubmit="createNewAdminAccount(event)">
        <div class="form-group">
          <label for="newAdminName">Admin Name</label>
          <input type="text" id="newAdminName" placeholder="Enter admin name" required>
        </div>
        <div class="form-group">
          <label for="newAdminEmail">Admin Email</label>
          <input type="email" id="newAdminEmail" placeholder="admin@example.com" required>
        </div>
        <div class="form-group">
          <label for="newAdminPassword">Password</label>
          <input type="password" id="newAdminPassword" placeholder="Enter password" required>
        </div>
        <div class="form-group">
          <label for="newAdminSecretKey">Secret Key</label>
          <input type="text" id="newAdminSecretKey" placeholder="Enter secret key" required>
          <small style="color: #666; font-size: 0.8rem;">Default secret key: 123</small>
        </div>
        <div class="form-group">
          <label for="newAdminRole">Admin Role</label>
          <select id="newAdminRole" required>
            <option value="">Select Role</option>
            <option value="super_admin">Super Admin</option>
            <option value="admin">Admin</option>
            <option value="moderator">Moderator</option>
            <option value="support">Support</option>
          </select>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeCreateAccountModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Admin</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Secret Key Info Modal -->
  <div id="secretKeyModal" class="modal">
    <div class="modal-content small-modal">
      <div class="modal-header">
        <h3><i class="fas fa-key"></i> Secret Key Information</h3>
        <button class="close-btn" onclick="closeSecretKeyModal()">&times;</button>
      </div>
      <div class="secret-key-info">
        <div class="info-card">
          <h4><i class="fas fa-lock"></i> Default Secret Key</h4>
          <div class="secret-key-display">
            <code>123</code>
            <button class="btn btn-sm btn-primary" onclick="copySecretKey()">
              <i class="fas fa-copy"></i> Copy
            </button>
          </div>
        </div>
        <div class="info-card">
          <h4><i class="fas fa-info-circle"></i> How to Use</h4>
          <ol>
            <li>Click "Create New Account" button</li>
            <li>Fill admin details (name, email, password)</li>
            <li>Enter secret key: <strong>123</strong></li>
            <li>Select admin role</li>
            <li>Click "Create Admin"</li>
            <li>New admin can login with created credentials</li>
          </ol>
        </div>
        <div class="info-card warning">
          <h4><i class="fas fa-exclamation-triangle"></i> Security Note</h4>
          <p>This is a demo secret key. In production, use a secure secret key and change it regularly.</p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="closeSecretKeyModal()">Got it!</button>
      </div>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div id="editUserModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-user-edit"></i> Edit User</h3>
        <button class="close-btn" onclick="closeEditModal()">&times;</button>
      </div>
      <form id="editUserForm" onsubmit="event.preventDefault(); console.log('üîß Form submit prevented'); return false;">
        <input type="hidden" id="editUserId">
        <div class="form-group">
          <label for="editUserName">Name</label>
          <input type="text" id="editUserName" required>
        </div>
        <div class="form-group">
          <label for="editUserEmail">Email</label>
          <input type="email" id="editUserEmail" required>
        </div>
        <div class="form-group">
          <label for="editUserWallet">Wallet Balance</label>
          <input type="number" id="editUserWallet" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="editUserStaked">Staked Amount</label>
          <input type="number" id="editUserStaked" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="editUserRewards">Reward Balance</label>
          <input type="number" id="editUserRewards" step="0.01" required>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="saveUserEdits()">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</body>
</html>
